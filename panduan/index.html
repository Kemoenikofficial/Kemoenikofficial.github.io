<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CALFATLOSS - Program Diet Herbal Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2D5A3D;
            --primary-light: #3F7A52;
            --primary-dark: #1E3D28;
            --accent-gold: #D4AF37;
            --accent-gold-light: #F4E4C1;
            --bg-cream: #FAF8F3;
            --bg-light: #F5F2EC;
            --text-dark: #1A1A1A;
            --text-muted: #6B6B6B;
            --success: #22C55E;
            --warning: #F59E0B;
            --danger: #EF4444;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.12);
            --radius: 20px;
            --radius-sm: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-cream);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .font-display {
            font-family: 'Playfair Display', serif;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-light);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse-gold {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
            50% { box-shadow: 0 0 0 15px rgba(212, 175, 55, 0); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .animate-fade-in {
            animation: fadeInUp 0.6s ease forwards;
        }
        
        .delay-100 { animation-delay: 0.1s; opacity: 0; }
        .delay-200 { animation-delay: 0.2s; opacity: 0; }
        .delay-300 { animation-delay: 0.3s; opacity: 0; }

        .hero-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            position: relative;
            overflow: hidden;
            padding: 60px 24px 80px;
        }

        .hero-pattern {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            color: var(--accent-gold-light);
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .hero-title {
            font-size: 36px;
            font-weight: 700;
            color: white;
            line-height: 1.2;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .hero-subtitle {
            font-size: 15px;
            color: rgba(255,255,255,0.8);
            font-weight: 300;
            margin-bottom: 32px;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 32px;
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-gold);
        }

        .hero-stat-label {
            font-size: 11px;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .main-container {
            max-width: 800px;
            margin: -40px auto 0;
            padding: 0 20px 60px;
            position: relative;
            z-index: 10;
        }

        .glass-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin-bottom: 24px;
            border: 1px solid rgba(0,0,0,0.04);
        }

        .card-header {
            padding: 24px;
            border-bottom: 1px solid rgba(0,0,0,0.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .card-body {
            padding: 24px;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 640px) {
            .calc-grid {
                grid-template-columns: 1fr;
            }
            .hero-title { font-size: 28px; }
            .hero-stats { gap: 20px; }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            background: var(--bg-light);
            border: 2px solid transparent;
            border-radius: var(--radius-sm);
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            background: white;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 4px rgba(45, 90, 61, 0.1);
        }

        select.form-input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%236B6B6B' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            cursor: pointer;
        }

        .activity-info-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            background: var(--bg-light);
            border-radius: 12px;
            margin-top: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
            user-select: none;
        }

        .activity-info-toggle:hover {
            background: rgba(63, 95, 74, 0.1);
        }

        .activity-info-toggle:active {
            background: rgba(63, 95, 74, 0.15);
        }

        .activity-info-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-muted);
        }

        .activity-info-icon {
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
        }

        .activity-info-icon.expanded {
            transform: rotate(180deg);
        }

        .activity-info-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .activity-info-content.expanded {
            max-height: 400px;
            padding-top: 12px;
        }

        .activity-list {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 16px;
        }

        .activity-row {
            display: flex;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.04);
        }

        .activity-row:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .activity-row:first-child {
            padding-top: 0;
        }

        .activity-badge {
            padding: 4px 10px;
            background: rgba(63, 122, 82, 0.15);
            color: var(--primary);
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            white-space: nowrap;
        }

        .activity-text {
            font-size: 12px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .results-dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .result-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: var(--radius-sm);
            padding: 20px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .result-card.accent {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #B8941F 100%);
        }

        .result-label {
            font-size: 11px;
            font-weight: 500;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .result-value {
            font-size: 32px;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 4px;
        }

        .result-unit {
            font-size: 12px;
            opacity: 0.8;
        }

        .timeline {
            position: relative;
            padding-left: 32px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 11px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--primary), var(--accent-gold));
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px dashed rgba(0,0,0,0.1);
        }

        .timeline-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .timeline-dot {
            position: absolute;
            left: -32px;
            top: 4px;
            width: 24px;
            height: 24px;
            background: white;
            border: 3px solid var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: var(--primary);
        }

        .timeline-dot.active {
            background: var(--primary);
            color: white;
            animation: pulse-gold 2s infinite;
        }

        .timeline-dot.completed {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .timeline-content h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .timeline-content p {
            font-size: 13px;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .herbal-card {
            background: linear-gradient(135deg, #F0F7F2 0%, #E8F5E9 100%);
            border: 1px solid #C8E6C9;
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-top: 16px;
        }

        .herbal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .herbal-icon-box {
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            font-size: 20px;
            color: var(--primary);
        }

        .herbal-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .herbal-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        .herbal-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        @media (min-width: 768px) {
            .herbal-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        .herbal-item {
            background: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s ease;
        }

        .herbal-item:hover {
            transform: translateY(-2px);
        }

        .herbal-item-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .herbal-item-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .herbal-item-dose {
            font-size: 11px;
            color: var(--text-muted);
        }

        .dosage-box {
            background: white;
            border-radius: 10px;
            padding: 16px;
            border-left: 4px solid var(--accent-gold);
        }

        .dosage-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .dosage-schedule {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .dosage-schedule:last-child {
            border-bottom: none;
        }

        .dosage-time {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
        }

        .dosage-amount {
            font-size: 12px;
            color: var(--text-muted);
            text-align: right;
        }

        .dosage-note {
            margin-top: 12px;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 8px;
            font-size: 11px;
            color: var(--text-muted);
            font-style: italic;
        }

        .meal-grid {
            display: grid;
            gap: 16px;
        }

        .meal-card {
            background: var(--bg-light);
            border-radius: var(--radius-sm);
            padding: 16px;
            display: flex;
            gap: 16px;
            align-items: center;
            transition: all 0.3s ease;
        }

        .meal-card:hover {
            transform: translateX(4px);
            background: white;
            box-shadow: var(--shadow-md);
        }

        .meal-time-box {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            flex-shrink: 0;
            border: 2px solid var(--primary);
        }

        .meal-time-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meal-time-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
            margin-top: 2px;
        }

        .meal-content {
            flex: 1;
        }

        .meal-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .meal-desc {
            font-size: 12px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .meal-cal {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
            white-space: nowrap;
        }

        .meal-alternative {
            margin-top: 16px;
            padding: 16px;
            background: #FEF3C7;
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--accent-gold);
        }

        .meal-alternative-title {
            font-size: 13px;
            font-weight: 600;
            color: #92400E;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .meal-alternative-text {
            font-size: 12px;
            color: #78350F;
            line-height: 1.6;
        }

        .progress-ring {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 24px;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
        }

        .progress-ring-bg {
            fill: none;
            stroke: var(--bg-light);
            stroke-width: 12;
        }

        .progress-ring-fill {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }

        .progress-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-percent {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }

        .progress-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .btn {
            width: 100%;
            padding: 16px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'Poppins', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(45, 90, 61, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(45, 90, 61, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #B8941F 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(212, 175, 55, 0.3);
            animation: pulse-gold 2s infinite;
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(212, 175, 55, 0.4);
        }

        .btn-outline {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #16A34A 100%);
            color: white;
        }

        .btn-loading {
            opacity: 0.7;
            cursor: not-allowed;
            pointer-events: none;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (min-width: 768px) {
            .tips-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .tip-card {
            background: white;
            border-radius: var(--radius-sm);
            padding: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0,0,0,0.04);
        }

        .tip-icon {
            width: 36px;
            height: 36px;
            background: var(--bg-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .tip-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .tip-desc {
            font-size: 11px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .consultation-card {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            border-radius: var(--radius);
            padding: 32px 24px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .consultation-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        .consultation-badge {
            display: inline-block;
            padding: 6px 16px;
            background: var(--accent-gold);
            color: white;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .consultation-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
            position: relative;
        }

        .consultation-desc {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 24px;
            position: relative;
        }

        .wa-link {
            display: block;
            text-decoration: none;
            color: white;
        }

        .section-hidden {
            display: none;
        }

        .section-visible {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        /* Weekly Evaluation Styles */
        .weekly-eval-section {
            margin-top: 24px;
            padding: 20px;
            background: linear-gradient(135deg, #F0F7F2 0%, #E8F5E9 100%);
            border-radius: var(--radius-sm);
            border: 1px solid #C8E6C9;
        }

        .weekly-eval-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .weekly-eval-grid {
            display: grid;
            gap: 12px;
        }

        .weekly-eval-item {
            background: white;
            border-radius: var(--radius-sm);
            padding: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .weekly-eval-item:hover {
            background: #f8faf8;
        }

        .weekly-eval-item:active {
            transform: scale(0.98);
        }

        .weekly-eval-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--primary);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .weekly-eval-checkbox.checked {
            background: var(--primary);
            color: white;
        }

        .weekly-eval-checkbox i {
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .weekly-eval-checkbox.checked i {
            opacity: 1;
        }

        .weekly-eval-label {
            font-size: 13px;
            color: var(--text-dark);
        }

        .weight-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .weight-result {
            background: white;
            border-radius: var(--radius-sm);
            padding: 16px;
            text-align: center;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
        }

        .weight-result-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .weight-result-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .weight-result-value.negative {
            color: var(--danger);
        }

        .kendala-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--bg-light);
            border-radius: var(--radius-sm);
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.3s ease;
        }

        .kendala-textarea:focus {
            outline: none;
            border-color: var(--primary-light);
        }

        .submit-eval-btn {
            margin-top: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }

        .eval-note {
            margin-top: 12px;
            padding: 12px;
            background: #FEF3C7;
            border-radius: 8px;
            font-size: 11px;
            color: #92400E;
            text-align: center;
        }

        .success-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 8px 24px rgba(34, 197, 94, 0.4);
            z-index: 1000;
            opacity: 0;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .success-toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .activity-section {
            margin-top: 24px;
            padding: 16px;
            background: #EFF6FF;
            border-radius: var(--radius-sm);
            border-left: 4px solid #3B82F6;
        }

        .activity-section h4 {
            font-size: 14px;
            font-weight: 600;
            color: #1E40AF;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .activity-item {
            font-size: 13px;
            color: #1E40AF;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .activity-note {
            font-size: 11px;
            color: #3B82F6;
            margin-top: 12px;
            font-style: italic;
        }

        @media print {
            .no-print { display: none !important; }
        }

        @media (min-width: 768px) {
            .hero-title { font-size: 48px; }
            .main-container { padding: 0 40px 60px; }
        }

        @media (prefers-reduced-motion: reduce) {
            * { animation-duration: 0.01ms !important; }
        }
    </style>
</head>
<body>

    <!-- Toast Notification -->
    <div id="successToast" class="success-toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Data berhasil dikirim!</span>
    </div>

    <!-- Main App -->
    <div id="mainApp">
        
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-pattern"></div>
            <div class="hero-content">
                <div class="hero-badge">
                    <i class="fas fa-leaf"></i>
                    Program Diet Herbal Premium
                </div>
                <h1 class="hero-title font-display">Transformasi Tubuh Alami</h1>
                <p class="hero-subtitle">Gabungan sains nutrisi modern & kearifan lokal herbal untuk penurunan berat badan optimal</p>
                
                <div class="hero-stats">
                    <div class="hero-stat">
                        <div class="hero-stat-value" id="heroWeeks">12</div>
                        <div class="hero-stat-label">Minggu Program</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value" id="heroLoss">0.5-1</div>
                        <div class="hero-stat-label">Kg/Minggu</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value">5</div>
                        <div class="hero-stat-label">Herba Aktif</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Container -->
        <div class="main-container">

            <!-- STEP 1: Kalkulator -->
            <div class="glass-card animate-fade-in delay-100" id="calculatorSection">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon"><i class="fas fa-calculator"></i></div>
                        Kalkulator Diet Cerdas
                    </div>
                </div>
                <div class="card-body">
                    <div class="results-dashboard" id="quickResults" style="display: none;">
                        <div class="result-card">
                            <div class="result-label">Kalori Harian</div>
                            <div class="result-value" id="previewCalories">0</div>
                            <div class="result-unit">kcal</div>
                        </div>
                        <div class="result-card accent">
                            <div class="result-label">Target Turun</div>
                            <div class="result-value" id="previewWeeks">0</div>
                            <div class="result-unit">minggu</div>
                        </div>
                    </div>

                    <div class="calc-grid">
                        <div class="form-group">
                            <label class="form-label">Nama Lengkap</label>
                            <input type="text" id="inputNama" class="form-input" placeholder="Masukkan nama">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Jenis Kelamin</label>
                            <select id="inputGender" class="form-input">
                                <option value="">Pilih Gender</option>
                                <option value="pria">Laki-laki</option>
                                <option value="wanita">Perempuan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Usia (tahun)</label>
                            <input type="number" id="inputUsia" class="form-input" placeholder="25" min="15" max="80">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Berat Badan (kg)</label>
                            <input type="number" id="inputBerat" class="form-input" placeholder="70" min="30" max="200" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tinggi Badan (cm)</label>
                            <input type="number" id="inputTinggi" class="form-input" placeholder="165" min="100" max="250">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Aktivitas Harian</label>
                            <select id="inputAktivitas" class="form-input">
                                <option value="">Pilih Level</option>
                                <option value="1.2">Tidak Aktif</option>
                                <option value="1.375">Ringan (1-2x Olahraga)</option>
                                <option value="1.55">Sedang (3-5x Olahraga)</option>
                                <option value="1.725">Berat (6-7x Olahraga)</option>
                                <option value="1.9">Atlet</option>
                            </select>

                            <div class="activity-info-toggle" id="activityToggle" role="button" tabindex="0" aria-expanded="false">
                                <span class="activity-info-label">Lihat keterangan aktivitas</span>
                                <svg class="activity-info-icon" id="activityIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 9l6 6 6-6"/>
                                </svg>
                            </div>
                            <div class="activity-info-content" id="activityContent">
                                <div class="activity-list">
                                    <div class="activity-row">
                                        <span class="activity-badge">Tidak Aktif</span>
                                        <span class="activity-text">Kerja duduk, jarang olahraga, aktivitas minim</span>
                                    </div>
                                    <div class="activity-row">
                                        <span class="activity-badge">Ringan</span>
                                        <span class="activity-text">Jalan 30 menit, yoga ringan, gym santai</span>
                                    </div>
                                    <div class="activity-row">
                                        <span class="activity-badge">Sedang</span>
                                        <span class="activity-text">Angkat beban rutin, lari 30-45 menit</span>
                                    </div>
                                    <div class="activity-row">
                                        <span class="activity-badge">Berat</span>
                                        <span class="activity-text">Latihan intens tiap hari, pekerja fisik berat</span>
                                    </div>
                                    <div class="activity-row">
                                        <span class="activity-badge">Atlet</span>
                                        <span class="activity-text">Latihan profesional, kompetisi aktif</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Target Berat (kg)</label>
                            <input type="number" id="inputTarget" class="form-input" placeholder="60" min="30" max="200" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Kecepatan Diet</label>
                            <select id="inputMetode" class="form-input">
                                <option value="ringan">Ringan (300 kcal defisit)</option>
                                <option value="standar" selected>Standar (500 kcal defisit)</option>
                                <option value="agresif">Agresif (700 kcal defisit)</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-primary" id="generateBtn" onclick="calculateAndShowProgram()">
                        <i class="fas fa-magic"></i>
                        Generate Program Diet Saya
                    </button>
                </div>
            </div>

            <!-- STEP 2: Program Timeline -->
            <div class="glass-card section-hidden" id="programSection">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon"><i class="fas fa-route"></i></div>
                        Timeline Program Anda
                    </div>
                    <span style="font-size: 11px; font-weight: 600; color: var(--success); background: rgba(34, 197, 94, 0.1); padding: 4px 12px; border-radius: 50px;">Aktif</span>
                </div>
                <div class="card-body">
                    
                    <div class="progress-ring">
                        <svg width="200" height="200">
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#2D5A3D"/>
                                    <stop offset="100%" style="stop-color:#D4AF37"/>
                                </linearGradient>
                            </defs>
                            <circle class="progress-ring-bg" cx="100" cy="100" r="88"/>
                            <circle class="progress-ring-fill" id="progressCircle" cx="100" cy="100" r="88" 
                                    stroke-dasharray="553" stroke-dashoffset="553"/>
                        </svg>
                        <div class="progress-content">
                            <div class="progress-percent" id="progressPercent">0%</div>
                            <div class="progress-label">Menuju Target</div>
                        </div>
                    </div>

                    <div class="timeline" id="dietTimeline"></div>

                    <!-- Herbal Product -->
                    <div class="herbal-card">
                        <div class="herbal-header">
                            <div class="herbal-icon-box">
                                <i class="fas fa-capsules"></i>
                            </div>
                            <div>
                                <div class="herbal-title">Suplemen Herbal CALFATLOSS</div>
                                <div class="herbal-subtitle">Formula 5 Herba Aktif Premium (500mg/kapsul)</div>
                            </div>
                        </div>
                        
                        <div class="herbal-grid">
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üçÉ</div>
                                <div class="herbal-item-name">Teh Hijau</div>
                                <div class="herbal-item-dose">170mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üå≥</div>
                                <div class="herbal-item-name">Jati Belanda</div>
                                <div class="herbal-item-dose">120mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üåø</div>
                                <div class="herbal-item-name">Daun Kemuning</div>
                                <div class="herbal-item-dose">110mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">ü´ö</div>
                                <div class="herbal-item-name">Temulawak</div>
                                <div class="herbal-item-dose">50mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üå±</div>
                                <div class="herbal-item-name">Tempuyung</div>
                                <div class="herbal-item-dose">50mg</div>
                            </div>
                        </div>

                        <div class="dosage-box">
                            <div class="dosage-title">
                                <i class="fas fa-clock" style="color: var(--accent-gold); margin-right: 8px;"></i>
                                Jadwal Konsumsi Optimal (2x3 Kapsul)
                            </div>
                            
                            <div class="dosage-schedule">
                                <span class="dosage-time">
                                    <i class="fas fa-sun" style="color: #F59E0B; margin-right: 8px;"></i>
                                    Pagi (07:00 - 08:00)
                                </span>
                                <span class="dosage-amount">
                                    3 Kapsul<br>
                                    <small>Sesudah Sarapan + Air Hangat</small>
                                </span>
                            </div>
                            
                            <div class="dosage-schedule">
                                <span class="dosage-time">
                                    <i class="fas fa-moon" style="color: #3B82F6; margin-right: 8px;"></i>
                                    Malam (18:00 - 19:00)
                                </span>
                                <span class="dosage-amount">
                                    3 Kapsul<br>
                                    <small>Sesudah Makan Malam + Air Putih</small>
                                </span>
                            </div>

                            <div class="dosage-note">
                                <i class="fas fa-info-circle" style="margin-right: 4px;"></i>
                                <strong>Alternatif:</strong> Bisa juga dikonsumsi 3x2 kapsul (Pagi, Siang, Malam) sesudah makan. 
                                Total 6 kapsul/hari untuk hasil optimal.
                            </div>
                        </div>
                    </div>

                    <!-- Activity Section -->
                    <div class="activity-section">
                        <h4>
                            <i class="fas fa-running"></i>
                            Aktivitas Fisik Harian (Minimal 30 Menit)
                        </h4>
                        <div class="activity-grid">
                            <div class="activity-item">
                                <i class="fas fa-star" style="color: #EAB308;"></i>
                                <span><strong>Olahraga Lymphatic</strong></span>
                            </div>
                            <div class="activity-item">
                                <i class="fas fa-walking" style="color: var(--success);"></i>
                                <span>Jalan kaki cepat</span>
                            </div>
                            <div class="activity-item">
                                <i class="fas fa-heartbeat" style="color: #EF4444;"></i>
                                <span>Lompat tali</span>
                            </div>
                            <div class="activity-item">
                                <i class="fas fa-child" style="color: #F97316;"></i>
                                <span>Jumping jack</span>
                            </div>
                        </div>
                        <p class="activity-note">
                            *Olahraga lymphatic dan jalan kaki lebih disarankan. Lihat gerakan lymphatic di YouTube.
                        </p>
                    </div>

                    <button class="btn btn-outline" style="margin-top: 24px;" onclick="showMealPlan()">
                        Lihat Jadwal Makan Detail
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- STEP 3: Meal Plan + Weekly Evaluation -->
            <div class="glass-card section-hidden" id="mealSection">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon"><i class="fas fa-utensils"></i></div>
                        Panduan Menu & Evaluasi Mingguan
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 11px; color: var(--text-muted);">Target Kalori</div>
                        <div style="font-size: 18px; font-weight: 700; color: var(--primary);" id="mealTargetCal">0 kcal</div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="meal-grid" id="mealContainer"></div>

                    <!-- Alternative Menu Note -->
                    <div class="meal-alternative">
                        <div class="meal-alternative-title">
                            <i class="fas fa-lightbulb"></i>
                            Catatan Alternatif Menu
                        </div>
                        <div class="meal-alternative-text">
                            Tidak harus mengikuti menu di atas persis! Yang penting <strong>asupan kalori tetap terjaga</strong> sesuai target. 
                            Anda bisa mengganti dengan makanan lain yang setara kalori dan nutrisinya.
                        </div>
                    </div>

                    <!-- Weekly Evaluation Form -->
                    <div class="weekly-eval-section">
                        <div class="weekly-eval-title">
                            <i class="fas fa-chart-line" style="color: var(--primary);"></i>
                            Evaluasi Mingguan (Data untuk Admin)
                        </div>

                        <!-- Weight Inputs -->
                        <div class="weight-input-group">
                            <div>
                                <label class="form-label">Berat Awal Minggu (kg)</label>
                                <input type="number" id="beratAwal" class="form-input" placeholder="70.0" step="0.1">
                            </div>
                            <div>
                                <label class="form-label">Berat Akhir Minggu (kg)</label>
                                <input type="number" id="beratAkhir" class="form-input" placeholder="69.0" step="0.1">
                            </div>
                        </div>

                        <!-- Auto Calculate Result -->
                        <div class="weight-result">
                            <div class="weight-result-label">Hasil Penurunan Berat Badan</div>
                            <div class="weight-result-value" id="turunBerat">0.0 kg</div>
                        </div>

                        <!-- Body Condition Checklist -->
                        <div style="margin-bottom: 16px;">
                            <label class="form-label" style="margin-bottom: 12px;">Kondisi Tubuh (Centang yang sesuai)</label>
                            <div class="weekly-eval-grid" id="kondisiContainer">
                                <div class="weekly-eval-item" data-kondisi="energi">
                                    <div class="weekly-eval-checkbox" data-id="energi"><i class="fas fa-check"></i></div>
                                    <span class="weekly-eval-label">Energi stabil sepanjang hari</span>
                                </div>
                                <div class="weekly-eval-item" data-kondisi="nafsu">
                                    <div class="weekly-eval-checkbox" data-id="nafsu"><i class="fas fa-check"></i></div>
                                    <span class="weekly-eval-label">Nafsu makan terkontrol</span>
                                </div>
                                <div class="weekly-eval-item" data-kondisi="efek">
                                    <div class="weekly-eval-checkbox" data-id="efek"><i class="fas fa-check"></i></div>
                                    <span class="weekly-eval-label">Tidak ada efek samping</span>
                                </div>
                                <div class="weekly-eval-item" data-kondisi="tidur">
                                    <div class="weekly-eval-checkbox" data-id="tidur"><i class="fas fa-check"></i></div>
                                    <span class="weekly-eval-label">Tidur cukup (7-8 jam)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Kendala -->
                        <div style="margin-bottom: 16px;">
                            <label class="form-label">Ada kendala minggu ini?</label>
                            <textarea id="kendalaText" class="kendala-textarea" placeholder="Ceritakan kendala atau kesulitan yang Anda alami selama program diet ini..."></textarea>
                        </div>

                        <!-- Submit Button -->
                        <button class="btn submit-eval-btn" id="submitEvalBtn" onclick="submitWeeklyEval()">
                            <i class="fas fa-paper-plane"></i>
                            <span id="submitBtnText">Kirim Evaluasi ke Admin</span>
                        </button>

                        <div class="eval-note">
                            <i class="fas fa-info-circle" style="margin-right: 4px;"></i>
                            Data ini akan disimpan admin untuk follow-up dan monitoring progress Anda.
                        </div>
                    </div>

                    <!-- Tips -->
                    <div style="margin-top: 24px;">
                        <h4 style="font-weight: 600; margin-bottom: 16px; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted);">Tips Sukses Diet</h4>
                        <div class="tips-grid">
                            <div class="tip-card">
                                <div class="tip-icon" style="color: #3B82F6;"><i class="fas fa-tint"></i></div>
                                <div class="tip-title">Hidrasi</div>
                                <div class="tip-desc">Minum 8 gelas air putih sepanjang hari</div>
                            </div>
                            <div class="tip-card">
                                <div class="tip-icon" style="color: var(--success);"><i class="fas fa-bed"></i></div>
                                <div class="tip-title">Tidur</div>
                                <div class="tip-desc">Istirahat 7-8 jam untuk metabolisme optimal</div>
                            </div>
                            <div class="tip-card">
                                <div class="tip-icon" style="color: #EAB308;"><i class="fas fa-walking"></i></div>
                                <div class="tip-title">Aktivitas</div>
                                <div class="tip-desc">Minimal 30 menit aktivitas fisik</div>
                            </div>
                            <div class="tip-card">
                                <div class="tip-icon" style="color: #EF4444;"><i class="fas fa-ban"></i></div>
                                <div class="tip-title">Hindari</div>
                                <div class="tip-desc">Gula, gorengan, & minuman bersoda</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Consultation CTA - FIXED -->
            <div class="consultation-card animate-fade-in delay-300 no-print">
                <div class="consultation-badge">Gratis Konsultasi</div>
                <h3 class="consultation-title font-display">Butuh Pendampingan?</h3>
                <p class="consultation-desc">Dapatkan konsultasi gratis dengan ahli gizi kami untuk memaksimalkan hasil program diet herbal Anda.</p>
                <a href="https://wa.me/6281546450547?text=Halo%2C%20saya%20ingin%20konsultasi%20program%20diet%20CALFATLOSS" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   class="btn btn-gold wa-link"
                   id="waConsultBtn"
                   onclick="handleWaClick(event)">
                    <i class="fab fa-whatsapp"></i>
                    Hubungi Konsultan Sekarang
                </a>
            </div>

            <!-- Footer -->
            <footer style="text-align: center; color: #9CA3AF; font-size: 11px; margin-top: 32px; padding-bottom: 32px;">
                <p style="margin-bottom: 8px;">CALFATLOSS - Smart Nutrition System</p>
                <p>Hasil estimasi, konsultasikan dengan ahli gizi untuk kondisi khusus</p>
            </footer>

        </div>
    </div>

    <script>
        // ==================== DATA STORAGE ====================
        let userData = {
            nama: '',
            gender: '',
            usia: 0,
            berat: 0,
            tinggi: 0,
            aktivitas: 0,
            target: 0,
            metode: 'standar',
            bmr: 0,
            tdee: 0,
            dietCal: 0,
            weeks: 0,
            protein: 0,
            lemak: 0,
            karbo: 0
        };

        let kondisiTubuh = {
            energi: false,
            nafsu: false,
            efek: false,
            tidur: false
        };

        const deficitMap = {
            'ringan': 300,
            'standar': 500,
            'agresif': 700
        };

        // Google Sheets URL - GANTI dengan URL Web App Anda yang benar
        const GOOGLE_SHEET_URL = "https://script.google.com/macros/s/AKfycbzKI-T3Ft64fgfy-2w5Ag5HDxkZWGTJ3x1zrwkoMcd55e7fZmDoNroKF8tM99Oe7k4x/exec";

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setupActivityToggle();
            setupKondisiToggle();
            setupWeightListeners();
        });

        function loadAllData() {
            // Load user data
            const savedUser = localStorage.getItem('calfatloss_userdata');
            if (savedUser) {
                try {
                    userData = JSON.parse(savedUser);
                    
                    // Fill inputs safely
                    const namaEl = document.getElementById('inputNama');
                    const genderEl = document.getElementById('inputGender');
                    const usiaEl = document.getElementById('inputUsia');
                    const beratEl = document.getElementById('inputBerat');
                    const tinggiEl = document.getElementById('inputTinggi');
                    const aktivitasEl = document.getElementById('inputAktivitas');
                    const targetEl = document.getElementById('inputTarget');
                    const metodeEl = document.getElementById('inputMetode');
                    
                    if (namaEl && userData.nama) namaEl.value = userData.nama;
                    if (genderEl && userData.gender) genderEl.value = userData.gender;
                    if (usiaEl && userData.usia) usiaEl.value = userData.usia;
                    if (beratEl && userData.berat) beratEl.value = userData.berat;
                    if (tinggiEl && userData.tinggi) tinggiEl.value = userData.tinggi;
                    if (aktivitasEl && userData.aktivitas) aktivitasEl.value = userData.aktivitas;
                    if (targetEl && userData.target) targetEl.value = userData.target;
                    if (metodeEl && userData.metode) metodeEl.value = userData.metode;
                    
                    // If complete, show program
                    if (userData.nama && userData.gender && userData.berat > 0) {
                        updateCalculatorUI();
                        generateTimeline();
                        generateMealPlan();
                        showSection('programSection');
                    }
                } catch (e) {
                    console.error('Error loading user data:', e);
                }
            }

            // Load weekly eval data
            const savedEval = localStorage.getItem('calfatloss_weeklyeval');
            if (savedEval) {
                try {
                    const evalData = JSON.parse(savedEval);
                    const beratAwalEl = document.getElementById('beratAwal');
                    const beratAkhirEl = document.getElementById('beratAkhir');
                    const kendalaEl = document.getElementById('kendalaText');
                    
                    if (beratAwalEl && evalData.beratAwal) beratAwalEl.value = evalData.beratAwal;
                    if (beratAkhirEl && evalData.beratAkhir) beratAkhirEl.value = evalData.beratAkhir;
                    if (kendalaEl && evalData.kendala) kendalaEl.value = evalData.kendala;
                    if (evalData.kondisi) kondisiTubuh = evalData.kondisi;
                    
                    hitungTurunBerat();
                    updateKondisiUI();
                } catch (e) {
                    console.error('Error loading eval data:', e);
                }
            }
        }

        function saveAllData() {
            try {
                localStorage.setItem('calfatloss_userdata', JSON.stringify(userData));
                
                const evalData = {
                    beratAwal: document.getElementById('beratAwal')?.value || '',
                    beratAkhir: document.getElementById('beratAkhir')?.value || '',
                    kondisi: kondisiTubuh,
                    kendala: document.getElementById('kendalaText')?.value || '',
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('calfatloss_weeklyeval', JSON.stringify(evalData));
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        // ==================== UI SETUP ====================
        function setupActivityToggle() {
            const toggle = document.getElementById('activityToggle');
            const icon = document.getElementById('activityIcon');
            const content = document.getElementById('activityContent');
            
            if (!toggle || !icon || !content) return;
            
            const handleToggle = function() {
                const expanded = content.classList.toggle('expanded');
                icon.classList.toggle('expanded', expanded);
                toggle.setAttribute('aria-expanded', String(expanded));
            };
            
            toggle.addEventListener('click', handleToggle);
            toggle.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleToggle();
                }
            });
        }

        function setupKondisiToggle() {
            const items = document.querySelectorAll('.weekly-eval-item[data-kondisi]');
            items.forEach(function(item) {
                item.addEventListener('click', function() {
                    const kondisi = this.getAttribute('data-kondisi');
                    if (kondisi) {
                        toggleKondisi(kondisi);
                    }
                });
            });
        }

        function setupWeightListeners() {
            const beratAwalEl = document.getElementById('beratAwal');
            const beratAkhirEl = document.getElementById('beratAkhir');
            
            if (beratAwalEl) {
                beratAwalEl.addEventListener('input', hitungTurunBerat);
                beratAwalEl.addEventListener('change', saveAllData);
            }
            if (beratAkhirEl) {
                beratAkhirEl.addEventListener('input', hitungTurunBerat);
                beratAkhirEl.addEventListener('change', saveAllData);
            }
        }

        function showSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('section-hidden');
                section.classList.add('section-visible');
            }
        }

        // ==================== CALCULATIONS ====================
        function calculateBMR(gender, weight, height, age) {
            if (gender === 'pria') {
                return (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                return (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }
        }

        function calculateAndShowProgram() {
            // Get values
            const namaEl = document.getElementById('inputNama');
            const genderEl = document.getElementById('inputGender');
            const usiaEl = document.getElementById('inputUsia');
            const beratEl = document.getElementById('inputBerat');
            const tinggiEl = document.getElementById('inputTinggi');
            const aktivitasEl = document.getElementById('inputAktivitas');
            const targetEl = document.getElementById('inputTarget');
            const metodeEl = document.getElementById('inputMetode');
            
            userData.nama = namaEl?.value?.trim() || '';
            userData.gender = genderEl?.value || '';
            userData.usia = parseFloat(usiaEl?.value) || 0;
            userData.berat = parseFloat(beratEl?.value) || 0;
            userData.tinggi = parseFloat(tinggiEl?.value) || 0;
            userData.aktivitas = parseFloat(aktivitasEl?.value) || 0;
            userData.target = parseFloat(targetEl?.value) || 0;
            userData.metode = metodeEl?.value || 'standar';

            // Validation
            if (!userData.nama) {
                showToast('Mohon isi nama lengkap Anda', 'error');
                namaEl?.focus();
                return;
            }
            
            if (!userData.gender) {
                showToast('Mohon pilih jenis kelamin', 'error');
                genderEl?.focus();
                return;
            }
            
            if (!userData.usia || userData.usia < 15 || userData.usia > 80) {
                showToast('Mohon isi usia yang valid (15-80 tahun)', 'error');
                usiaEl?.focus();
                return;
            }
            
            if (!userData.berat || userData.berat < 30 || userData.berat > 200) {
                showToast('Mohon isi berat badan yang valid (30-200 kg)', 'error');
                beratEl?.focus();
                return;
            }
            
            if (!userData.tinggi || userData.tinggi < 100 || userData.tinggi > 250) {
                showToast('Mohon isi tinggi badan yang valid (100-250 cm)', 'error');
                tinggiEl?.focus();
                return;
            }
            
            if (!userData.aktivitas) {
                showToast('Mohon pilih level aktivitas', 'error');
                aktivitasEl?.focus();
                return;
            }
            
            if (!userData.target || userData.target < 30 || userData.target > 200) {
                showToast('Mohon isi target berat yang valid', 'error');
                targetEl?.focus();
                return;
            }

            if (userData.target >= userData.berat) {
                showToast('Target berat harus lebih rendah dari berat saat ini', 'error');
                targetEl?.focus();
                return;
            }

            // Calculations
            userData.bmr = calculateBMR(userData.gender, userData.berat, userData.tinggi, userData.usia);
            userData.tdee = userData.bmr * userData.aktivitas;
            
            const deficit = deficitMap[userData.metode] || 500;
            userData.dietCal = Math.max(1200, userData.tdee - deficit);
            
            const weeklyLoss = (deficit * 7) / 7700;
            userData.weeks = Math.ceil((userData.berat - userData.target) / weeklyLoss);

            // Macros
            const proteinMult = userData.metode === 'agresif' ? 2.2 : (userData.metode === 'ringan' ? 1.8 : 2.0);
            userData.protein = userData.berat * proteinMult;
            userData.lemak = userData.berat * 0.8;
            userData.karbo = (userData.dietCal - (userData.protein * 4) - (userData.lemak * 9)) / 4;

            saveAllData();
            updateCalculatorUI();
            generateTimeline();
            generateMealPlan();
            
            showSection('programSection');
            
            setTimeout(function() {
                document.getElementById('programSection')?.scrollIntoView({ behavior: 'smooth' });
            }, 100);
            
            showToast('Program diet berhasil dibuat!', 'success');
        }

        function updateCalculatorUI() {
            const quickResults = document.getElementById('quickResults');
            const previewCalories = document.getElementById('previewCalories');
            const previewWeeks = document.getElementById('previewWeeks');
            const heroWeeks = document.getElementById('heroWeeks');
            const heroLoss = document.getElementById('heroLoss');
            
            if (quickResults) quickResults.style.display = 'grid';
            if (previewCalories) previewCalories.textContent = Math.round(userData.dietCal);
            if (previewWeeks) previewWeeks.textContent = userData.weeks;
            if (heroWeeks) heroWeeks.textContent = userData.weeks;
            if (heroLoss) {
                heroLoss.textContent = userData.metode === 'agresif' ? '0.7-1' : (userData.metode === 'ringan' ? '0.3-0.5' : '0.5-0.7');
            }
        }

        function generateTimeline() {
            const timeline = document.getElementById('dietTimeline');
            if (!timeline) return;
            
            timeline.innerHTML = '';

            const phases = [
                { week: 1, title: 'Fase Detox (Minggu 1)', desc: 'Adaptasi metabolisme. Mulai konsumsi 2x3 kapsul herbal sesudah makan (pagi & malam). Fokus pengurangan gula. Minimal 30 menit olahraga lymphatic/jalan kaki.' },
                { week: 2, title: 'Fase Aktivasi (Minggu 2)', desc: 'Metabolisme meningkat. Berat turun 0.5-1kg. Konsisten minum 6 kapsul/hari. Lanjutkan olahraga lymphatic dan jalan kaki 30 menit/hari.' },
                { week: 3, title: 'Fase Pembakaran (Minggu 3-4)', desc: 'Lemak terbakar efektif. Sinergi diet + herbal optimal. Jangan skip dosis pagi & malam. Minimal 30 menit aktivitas fisik.' },
                { week: 6, title: 'Evaluasi Tengah (Minggu 6)', desc: 'Cek progress. Jika stagnan, konsultasi gratis tersedia untuk penyesuaian dosis atau pola makan.' },
                { week: userData.weeks || 12, title: 'Target Tercapai!', desc: 'Selamat ' + (userData.nama || 'Peserta') + '! Capai target ' + userData.target + 'kg. Lanjutkan ke FASE MAINTENANCE: Turun dosis herbal jadi 2x2 kapsul/hari + pola makan seimbang untuk menjaga berat.' }
            ];

            phases.forEach(function(phase, index) {
                const isLast = index === phases.length - 1;
                const dotClass = isLast ? 'active' : '';
                const dotContent = isLast ? '‚úì' : phase.week;
                
                const html = '<div class="timeline-item">' +
                    '<div class="timeline-dot ' + dotClass + '">' + dotContent + '</div>' +
                    '<div class="timeline-content">' +
                    '<h4>' + phase.title + '</h4>' +
                    '<p>' + phase.desc + '</p>' +
                    '</div></div>';
                    
                timeline.innerHTML += html;
            });

            // Animate progress
            setTimeout(function() {
                const circle = document.getElementById('progressCircle');
                const percentEl = document.getElementById('progressPercent');
                
                if (circle && percentEl) {
                    const radius = 88;
                    const circumference = radius * 2 * Math.PI;
                    const offset = circumference - (10/100) * circumference;
                    circle.style.strokeDashoffset = offset;
                    percentEl.textContent = '10%';
                }
            }, 500);
        }

        function generateMealPlan() {
            const container = document.getElementById('mealContainer');
            const mealTargetCal = document.getElementById('mealTargetCal');
            
            if (!container) return;
            if (mealTargetCal) mealTargetCal.textContent = Math.round(userData.dietCal) + ' kcal';
            
            const meals = [
                { time: '07:00', title: 'Sarapan (25%)', cal: Math.round(userData.dietCal * 0.25), 
                  menu: '2 Telur rebus + 1 pisang + 3 kapsul herbal sesudah makan' },
                { time: '10:00', title: 'Snack Pagi (10%)', cal: Math.round(userData.dietCal * 0.10), 
                  menu: 'Buah segar (apel/jeruk) + kacang almond 10 butir' },
                { time: '12:00', title: 'Makan Siang (30%)', cal: Math.round(userData.dietCal * 0.30), 
                  menu: 'Nasi merah 100g + dada ayam 150g + sayur tumis' },
                { time: '15:00', title: 'Snack Sore (10%)', cal: Math.round(userData.dietCal * 0.10), 
                  menu: 'Yogurt plain + granola atau smoothie green' },
                { time: '18:00', title: 'Makan Malam (25%)', cal: Math.round(userData.dietCal * 0.25), 
                  menu: 'Ikan kukus 150g + salad sayur + kentang rebus + 3 kapsul herbal sesudah makan' }
            ];

            let html = '';
            meals.forEach(function(meal) {
                html += '<div class="meal-card">' +
                    '<div class="meal-time-box">' +
                    '<div class="meal-time-label">JAM</div>' +
                    '<div class="meal-time-value">' + meal.time + '</div>' +
                    '</div>' +
                    '<div class="meal-content">' +
                    '<div class="meal-title">' + meal.title + '</div>' +
                    '<div class="meal-desc">' + meal.menu + '</div>' +
                    '</div>' +
                    '<div class="meal-cal">~' + meal.cal + '<br><small>kcal</small></div>' +
                    '</div>';
            });
            
            container.innerHTML = html;
        }

        function showMealPlan() {
            showSection('mealSection');
            setTimeout(function() {
                document.getElementById('mealSection')?.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // ==================== WEEKLY EVALUATION ====================
        function hitungTurunBerat() {
            const awalEl = document.getElementById('beratAwal');
            const akhirEl = document.getElementById('beratAkhir');
            const turunEl = document.getElementById('turunBerat');
            
            if (!turunEl) return;
            
            const awal = parseFloat(awalEl?.value) || 0;
            const akhir = parseFloat(akhirEl?.value) || 0;
            const turun = awal - akhir;
            
            turunEl.textContent = (turun >= 0 ? '-' : '+') + Math.abs(turun).toFixed(1) + ' kg';
            turunEl.className = 'weight-result-value' + (turun < 0 ? ' negative' : '');
        }

        function toggleKondisi(id) {
            if (!kondisiTubuh.hasOwnProperty(id)) return;
            
            kondisiTubuh[id] = !kondisiTubuh[id];
            updateKondisiUI();
            saveAllData();
        }

        function updateKondisiUI() {
            Object.keys(kondisiTubuh).forEach(function(id) {
                const checkbox = document.querySelector('[data-id="' + id + '"]');
                if (checkbox) {
                    if (kondisiTubuh[id]) {
                        checkbox.classList.add('checked');
                    } else {
                        checkbox.classList.remove('checked');
                    }
                }
            });
        }

        function submitWeeklyEval() {
            const beratAwalEl = document.getElementById('beratAwal');
            const beratAkhirEl = document.getElementById('beratAkhir');
            const kendalaEl = document.getElementById('kendalaText');
            const submitBtn = document.getElementById('submitEvalBtn');
            const submitBtnText = document.getElementById('submitBtnText');
            
            const awal = beratAwalEl?.value?.trim();
            const akhir = beratAkhirEl?.value?.trim();
            const kendala = kendalaEl?.value?.trim() || '-';
            
            if (!awal) {
                showToast('Mohon isi berat awal minggu', 'error');
                beratAwalEl?.focus();
                return;
            }
            
            if (!akhir) {
                showToast('Mohon isi berat akhir minggu', 'error');
                beratAkhirEl?.focus();
                return;
            }
            
            // Show loading state
            if (submitBtn) {
                submitBtn.classList.add('btn-loading');
            }
            if (submitBtnText) {
                submitBtnText.innerHTML = '<span class="spinner" style="display: inline-block;"></span> Mengirim...';
            }

            // Prepare data - format for Google Sheets
            const formData = new FormData();
            formData.append('nama', userData.nama || '-');
            formData.append('gender', userData.gender || '-');
            formData.append('usia', String(userData.usia || 0));
            formData.append('beratAwal', awal);
            formData.append('beratAkhir', akhir);
            formData.append('turun', (parseFloat(awal) - parseFloat(akhir)).toFixed(1));
            formData.append('kondisi', Object.keys(kondisiTubuh).filter(function(k) { return kondisiTubuh[k]; }).join(', ') || '-');
            formData.append('kendala', kendala);
            formData.append('timestamp', new Date().toLocaleString('id-ID'));

            // Send to Google Sheets
            fetch(GOOGLE_SHEET_URL, {
                method: 'POST',
                mode: 'cors',
                body: formData
            })
            .then(function(response) {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Network response was not ok');
            })
            .then(function(data) {
                showToast('Evaluasi mingguan berhasil dikirim ke admin!', 'success');
                saveAllData();
            })
            .catch(function(error) {
                console.error('Fetch error:', error);
                // Try alternative method with no-cors
                return fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                });
            })
            .then(function(response) {
                if (response) {
                    // With no-cors, we can't read response but request was sent
                    showToast('Evaluasi mingguan berhasil dikirim ke admin!', 'success');
                    saveAllData();
                }
            })
            .catch(function(error) {
                console.error('Error:', error);
                // Save locally as backup
                let pendingSubmissions = JSON.parse(localStorage.getItem('calfatloss_pending') || '[]');
                pendingSubmissions.push({
                    nama: userData.nama || '-',
                    gender: userData.gender || '-',
                    usia: userData.usia || 0,
                    beratAwal: awal,
                    beratAkhir: akhir,
                    turun: (parseFloat(awal) - parseFloat(akhir)).toFixed(1),
                    kondisi: Object.keys(kondisiTubuh).filter(function(k) { return kondisiTubuh[k]; }).join(', ') || '-',
                    kendala: kendala,
                    timestamp: new Date().toLocaleString('id-ID')
                });
                localStorage.setItem('calfatloss_pending', JSON.stringify(pendingSubmissions));
                showToast('Data disimpan lokal. Akan dikirim saat koneksi tersedia.', 'warning');
            })
            .finally(function() {
                // Reset button state
                if (submitBtn) {
                    submitBtn.classList.remove('btn-loading');
                }
                if (submitBtnText) {
                    submitBtnText.innerHTML = '<i class="fas fa-paper-plane"></i> Kirim Evaluasi ke Admin';
                }
            });
        }

        // ==================== WHATSAPP BUTTON ====================
        function handleWaClick(event) {
            // Allow the link to work normally
            // This function can be used for analytics tracking
            console.log('WhatsApp consultation button clicked');
            
            // The link will open normally due to target="_blank"
            return true;
        }

        // ==================== TOAST NOTIFICATION ====================
        function showToast(message, type) {
            const toast = document.getElementById('successToast');
            const toastMessage = document.getElementById('toastMessage');
            
            if (!toast || !toastMessage) return;
            
            // Update message
            toastMessage.textContent = message;
            
            // Update color based on type
            if (type === 'error') {
                toast.style.background = '#EF4444';
            } else if (type === 'warning') {
                toast.style.background = '#F59E0B';
            } else {
                toast.style.background = '#22C55E';
            }
            
            // Show toast
            toast.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(function() {
                toast.classList.remove('show');
            }, 3000);
        }

        // ==================== AUTO-SAVE ====================
        // Save on input changes
        document.querySelectorAll('#inputNama, #inputGender, #inputUsia, #inputBerat, #inputTinggi, #inputAktivitas, #inputTarget, #inputMetode').forEach(function(el) {
            if (el) {
                el.addEventListener('change', function() {
                    userData.nama = document.getElementById('inputNama')?.value?.trim() || '';
                    userData.gender = document.getElementById('inputGender')?.value || '';
                    userData.usia = parseFloat(document.getElementById('inputUsia')?.value) || 0;
                    userData.berat = parseFloat(document.getElementById('inputBerat')?.value) || 0;
                    userData.tinggi = parseFloat(document.getElementById('inputTinggi')?.value) || 0;
                    userData.aktivitas = parseFloat(document.getElementById('inputAktivitas')?.value) || 0;
                    userData.target = parseFloat(document.getElementById('inputTarget')?.value) || 0;
                    userData.metode = document.getElementById('inputMetode')?.value || 'standar';
                    saveAllData();
                });
            }
        });

        // Save kendala text on change
        document.getElementById('kendalaText')?.addEventListener('change', saveAllData);

        // Save on page hide/close
        window.addEventListener('beforeunload', saveAllData);
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                saveAllData();
            }
        });
    </script>
</body>
</html>
