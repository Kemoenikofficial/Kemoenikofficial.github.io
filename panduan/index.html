<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CALFATLOSS - Program Diet Herbal Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2D5A3D;
            --primary-light: #3F7A52;
            --primary-dark: #1E3D28;
            --accent-gold: #D4AF37;
            --accent-gold-light: #F4E4C1;
            --bg-cream: #FAF8F3;
            --bg-light: #F5F2EC;
            --text-dark: #1A1A1A;
            --text-muted: #6B6B6B;
            --success: #22C55E;
            --warning: #F59E0B;
            --danger: #EF4444;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.12);
            --radius: 20px;
            --radius-sm: 12px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg-cream); color: var(--text-dark); line-height: 1.6; overflow-x: hidden; }
        .font-display { font-family: 'Playfair Display', serif; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-light); }
        ::-webkit-scrollbar-thumb { background: var(--primary-light); border-radius: 4px; }

        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-gold { 0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); } 50% { box-shadow: 0 0 0 15px rgba(212, 175, 55, 0); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes spin { to { transform: rotate(360deg); } }

        .animate-fade-in { animation: fadeInUp 0.6s ease forwards; }
        .delay-100 { animation-delay: 0.1s; opacity: 0; }
        .delay-200 { animation-delay: 0.2s; opacity: 0; }
        .delay-300 { animation-delay: 0.3s; opacity: 0; }

        /* Loading Screen */
        #loadingScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-cream); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
        .loader { width: 50px; height: 50px; border: 5px solid var(--bg-light); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }

        /* HERO SECTION */
        .hero-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            position: relative; overflow: hidden; padding: 60px 24px 80px;
        }
        .hero-pattern {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .hero-content { position: relative; z-index: 2; max-width: 600px; margin: 0 auto; text-align: center; }
        .hero-badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 50px; color: var(--accent-gold-light); font-size: 12px; font-weight: 500; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.2); }
        .hero-title { font-size: 36px; font-weight: 700; color: white; line-height: 1.2; margin-bottom: 12px; letter-spacing: -0.5px; }
        .hero-subtitle { font-size: 15px; color: rgba(255,255,255,0.8); font-weight: 300; margin-bottom: 32px; }
        .hero-stats { display: flex; justify-content: center; gap: 40px; margin-top: 32px; flex-wrap: wrap; }
        .hero-stat { text-align: center; }
        .hero-stat-value { font-size: 28px; font-weight: 700; color: var(--accent-gold); }
        .hero-stat-label { font-size: 11px; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 1px; }

        /* CONTAINER & CARDS */
        .main-container { max-width: 800px; margin: -40px auto 0; padding: 0 20px 60px; position: relative; z-index: 10; }
        .glass-card { background: white; border-radius: var(--radius); box-shadow: var(--shadow-lg); overflow: hidden; margin-bottom: 24px; border: 1px solid rgba(0,0,0,0.04); }
        .card-header { padding: 24px; border-bottom: 1px solid rgba(0,0,0,0.06); display: flex; align-items: center; justify-content: space-between; }
        .card-title { font-size: 16px; font-weight: 600; color: var(--text-dark); display: flex; align-items: center; gap: 12px; }
        .card-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; box-shadow: 0 4px 10px rgba(45,90,61,0.2); }
        .card-body { padding: 24px; }

        /* FORMS */
        .calc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        @media (max-width: 640px) { .calc-grid { grid-template-columns: 1fr; } }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .form-input { width: 100%; padding: 14px 16px; font-size: 15px; font-family: 'Poppins', sans-serif; background: var(--bg-light); border: 2px solid transparent; border-radius: var(--radius-sm); color: var(--text-dark); transition: all 0.3s ease; }
        .form-input:focus { outline: none; background: white; border-color: var(--primary-light); box-shadow: 0 0 0 4px rgba(45, 90, 61, 0.1); }
        select.form-input { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%236B6B6B' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 14px center; cursor: pointer; }
        
        /* Info Box for Activity */
        .info-box { background: #EFF6FF; border-left: 4px solid #3B82F6; padding: 12px; border-radius: 8px; margin-top: 8px; font-size: 12px; color: #1E40AF; display: none; }
        
        /* RESULTS DASHBOARD */
        .results-dashboard { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px; }
        @media(min-width: 640px) { .results-dashboard { grid-template-columns: repeat(4, 1fr); } }
        
        .result-card { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: var(--radius-sm); padding: 20px; color: white; text-align: center; position: relative; overflow: hidden; }
        .result-card::before { content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); }
        .result-card.accent { background: linear-gradient(135deg, var(--accent-gold) 0%, #B8941F 100%); }
        .result-card.date-card { background: linear-gradient(135deg, #1E3D28 0%, var(--primary) 100%); }
        .result-label { font-size: 11px; font-weight: 500; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .result-value { font-size: 24px; font-weight: 700; line-height: 1.1; margin-bottom: 4px; }
        .result-unit { font-size: 12px; opacity: 0.8; }

        /* MACRO NUTRIENTS BAR */
        .macro-section { margin-top: 20px; padding-top: 20px; border-top: 1px dashed rgba(0,0,0,0.08); }
        .macro-title { font-size: 13px; font-weight: 600; color: var(--text-muted); margin-bottom: 12px; text-transform: uppercase; }
        .macro-bar-container { display: flex; height: 24px; border-radius: 12px; overflow: hidden; background: #eee; margin-bottom: 8px; }
        .macro-segment { display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 600; transition: width 1s ease; }
        .macro-legend { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-muted); }

        /* TIMELINE */
        .timeline { position: relative; padding-left: 32px; }
        .timeline::before { content: ''; position: absolute; left: 11px; top: 0; bottom: 0; width: 2px; background: linear-gradient(to bottom, var(--primary), var(--accent-gold)); }
        .timeline-item { position: relative; margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px dashed rgba(0,0,0,0.1); }
        .timeline-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .timeline-dot { position: absolute; left: -32px; top: 4px; width: 24px; height: 24px; background: white; border: 3px solid var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: var(--primary); transition: all 0.3s ease; }
        .timeline-dot.active { background: var(--primary); color: white; animation: pulse-gold 2s infinite; }
        .timeline-dot.completed { background: var(--success); border-color: var(--success); color: white; }
        .timeline-content h4 { font-size: 15px; font-weight: 600; margin-bottom: 8px; color: var(--text-dark); }
        .timeline-content p { font-size: 13px; color: var(--text-muted); line-height: 1.6; }

        /* HERBAL CARD */
        .herbal-card { background: linear-gradient(135deg, #F0F7F2 0%, #E8F5E9 100%); border: 1px solid #C8E6C9; border-radius: var(--radius-sm); padding: 20px; margin-top: 16px; }
        .herbal-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
        .herbal-icon-box { width: 48px; height: 48px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-sm); font-size: 20px; color: var(--primary); }
        .herbal-title { font-size: 16px; font-weight: 600; color: var(--primary-dark); }
        .herbal-subtitle { font-size: 12px; color: var(--text-muted); }
        .herbal-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px; }
        @media (min-width: 768px) { .herbal-grid { grid-template-columns: repeat(5, 1fr); } }
        .herbal-item { background: white; padding: 12px; border-radius: 10px; text-align: center; box-shadow: var(--shadow-sm); transition: transform 0.3s ease; }
        .herbal-item:hover { transform: translateY(-2px); }
        .herbal-item-icon { width: 32px; height: 32px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .herbal-item-name { font-size: 12px; font-weight: 600; color: var(--primary); margin-bottom: 4px; }
        .herbal-item-dose { font-size: 11px; color: var(--text-muted); }
        .dosage-box { background: white; border-radius: 10px; padding: 16px; border-left: 4px solid var(--accent-gold); }
        .dosage-title { font-size: 13px; font-weight: 600; margin-bottom: 12px; color: var(--text-dark); }
        .dosage-schedule { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .dosage-schedule:last-child { border-bottom: none; }
        .dosage-time { font-size: 13px; font-weight: 600; color: var(--primary); }
        .dosage-amount { font-size: 12px; color: var(--text-muted); text-align: right; }
        .dosage-note { margin-top: 12px; padding: 10px; background: var(--bg-light); border-radius: 8px; font-size: 11px; color: var(--text-muted); font-style: italic; }

        /* MEAL PLAN */
        .meal-grid { display: grid; gap: 16px; }
        .meal-card { background: var(--bg-light); border-radius: var(--radius-sm); padding: 16px; display: flex; gap: 16px; align-items: center; transition: all 0.3s ease; }
        .meal-card:hover { transform: translateX(4px); background: white; box-shadow: var(--shadow-md); }
        .meal-time-box { width: 70px; height: 70px; background: white; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: var(--shadow-sm); flex-shrink: 0; border: 2px solid var(--primary); }
        .meal-time-label { font-size: 11px; font-weight: 600; color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px; }
        .meal-time-value { font-size: 18px; font-weight: 700; color: var(--text-dark); margin-top: 2px; }
        .meal-content { flex: 1; }
        .meal-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .meal-desc { font-size: 12px; color: var(--text-muted); line-height: 1.5; }
        .meal-cal { font-size: 13px; font-weight: 600; color: var(--primary); white-space: nowrap; }

        /* PROGRESS RING */
        .progress-ring { position: relative; width: 200px; height: 200px; margin: 0 auto 24px; }
        .progress-ring svg { transform: rotate(-90deg); }
        .progress-ring-bg { fill: none; stroke: var(--bg-light); stroke-width: 12; }
        .progress-ring-fill { fill: none; stroke: url(#gradient); stroke-width: 12; stroke-linecap: round; transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .progress-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .progress-percent { font-size: 48px; font-weight: 700; color: var(--primary); line-height: 1; }
        .progress-label { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

        .btn { width: 100%; padding: 16px 24px; border: none; border-radius: var(--radius-sm); font-family: 'Poppins', sans-serif; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; box-shadow: 0 4px 16px rgba(45, 90, 61, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(45, 90, 61, 0.4); }
        .btn-gold { background: linear-gradient(135deg, var(--accent-gold) 0%, #B8941F 100%); color: white; box-shadow: 0 4px 16px rgba(212, 175, 55, 0.3); }
        .btn-outline { background: white; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary); color: white; }
        
        /* Custom Checkboxes for Weekly Eval */
        .check-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
        @media (max-width: 640px) { .check-grid { grid-template-columns: 1fr; } }
        .check-item { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 12px; background: var(--bg-light); border-radius: 8px; transition: all 0.2s; border: 1px solid transparent; }
        .check-item:hover { background: white; border-color: var(--primary-light); }
        .check-item input { display: none; }
        .check-box { width: 22px; height: 22px; border: 2px solid var(--primary); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: transparent; transition: all 0.2s; }
        .check-item input:checked + .check-box { background: var(--primary); color: white; }
        .check-label { font-size: 13px; font-weight: 500; color: var(--text-dark); }

        .section-hidden { display: none; }
        .section-visible { display: block; animation: fadeInUp 0.5s ease; }
        
        .footer-info { text-align: center; margin-top: 40px; padding: 24px; background: white; border-radius: var(--radius); box-shadow: var(--shadow-sm); }
        .footer-info h4 { font-size: 16px; font-weight: 600; margin-bottom: 8px; color: var(--primary); }
        .footer-info p { font-size: 13px; color: var(--text-muted); margin-bottom: 16px; }

        @media print {
            body { background: white; }
            .no-print { display: none !important; }
            .glass-card { box-shadow: none; border: 1px solid #ddd; break-inside: avoid; }
            .result-card { border: 1px solid #ddd; color: black !important; background: white !important; }
            .result-card * { color: black !important; }
            .check-item { border: 1px solid #ddd; }
        }
    </style>
</head>
<body>

    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loader"></div>
        <p style="margin-top: 20px; color: var(--primary); font-weight: 600;">Memuat Data Program...</p>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-pattern"></div>
            <div class="hero-content">
                <div class="hero-badge">
                    <i class="fas fa-leaf"></i>
                    Program Diet Herbal Premium
                </div>
                <h1 class="hero-title font-display">Transformasi Tubuh Alami</h1>
                <p class="hero-subtitle">Gabungan sains nutrisi modern & kearifan lokal herbal untuk penurunan berat badan optimal</p>
                
                <div class="hero-stats">
                    <div class="hero-stat">
                        <div class="hero-stat-value" id="heroWeeks">-</div>
                        <div class="hero-stat-label">Minggu Program</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value" id="heroLoss">-</div>
                        <div class="hero-stat-label">Kg/Minggu</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value">5</div>
                        <div class="hero-stat-label">Herba Aktif</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Container -->
        <div class="main-container">

            <!-- STEP 1: Kalkulator -->
            <div class="glass-card animate-fade-in delay-100" id="calculatorSection">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon"><i class="fas fa-calculator"></i></div>
                        Kalkulator Diet Cerdas
                    </div>
                    <span class="text-xs text-gray-500" id="userCodeDisplay">Kode: -</span>
                </div>
                <div class="card-body">
                    <div class="results-dashboard" id="quickResults" style="display: none;">
                        <div class="result-card">
                            <div class="result-label">Kalori Diet</div>
                            <div class="result-value" id="previewCalories">0</div>
                            <div class="result-unit">kcal/hari</div>
                        </div>
                        <div class="result-card accent">
                            <div class="result-label">Durasi Program</div>
                            <div class="result-value" id="previewWeeks">0</div>
                            <div class="result-unit">minggu</div>
                        </div>
                        <div class="result-card date-card">
                            <div class="result-label">Estimasi Target</div>
                            <div class="result-value" style="font-size: 18px;" id="previewDate">-</div>
                            <div class="result-unit" id="previewDateRelative">-</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">Target Berat</div>
                            <div class="result-value" id="previewTarget">0</div>
                            <div class="result-unit">kg</div>
                        </div>
                        
                        <!-- Macro Bar -->
                        <div class="macro-section" style="grid-column: 1 / -1;">
                            <div class="macro-title">Komposisi Makro Nutrien Harian</div>
                            <div class="macro-bar-container">
                                <div class="macro-segment" id="barProtein" style="background: #EF4444; width: 0%;">P</div>
                                <div class="macro-segment" id="barLemak" style="background: #F59E0B; width: 0%;">L</div>
                                <div class="macro-segment" id="barKarbo" style="background: #3B82F6; width: 0%;">K</div>
                            </div>
                            <div class="macro-legend">
                                <span><span style="color:#EF4444">‚ñ†</span> Protein (<span id="pctProtein">0</span>%)</span>
                                <span><span style="color:#F59E0B">‚ñ†</span> Lemak (<span id="pctLemak">0</span>%)</span>
                                <span><span style="color:#3B82F6">‚ñ†</span> Karbo (<span id="pctKarbo">0</span>%)</span>
                            </div>
                        </div>
                    </div>

                    <div class="calc-grid">
                        <div class="form-group">
                            <label class="form-label">Nama Lengkap</label>
                            <input type="text" id="inputNama" class="form-input" placeholder="Masukkan nama">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Jenis Kelamin</label>
                            <select id="inputGender" class="form-input">
                                <option value="">Pilih Gender</option>
                                <option value="pria">Laki-laki</option>
                                <option value="wanita">Perempuan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Usia (tahun)</label>
                            <input type="number" id="inputUsia" class="form-input" placeholder="25" min="15" max="80">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Berat Badan (kg)</label>
                            <input type="number" id="inputBerat" class="form-input" placeholder="70" min="30" max="200" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tinggi Badan (cm)</label>
                            <input type="number" id="inputTinggi" class="form-input" placeholder="165" min="100" max="250">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Aktivitas Harian</label>
                            <select id="inputAktivitas" class="form-input" onchange="updateActivityInfo()">
                                <option value="">Pilih Level Aktivitas</option>
                                <option value="1.2">Sedentari (Jarang Bergerak / Pekerja Kantoran)</option>
                                <option value="1.375">Ringan (Olahraga 1-3x/minggu)</option>
                                <option value="1.55">Sedang (Olahraga 3-5x/minggu)</option>
                                <option value="1.725">Berat (Olahraga Intens 6-7x/minggu)</option>
                            </select>
                            <div id="activityInfo" class="info-box"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Target Berat (kg)</label>
                            <input type="number" id="inputTarget" class="form-input" placeholder="60" min="30" max="200" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Kecepatan Diet</label>
                            <select id="inputMetode" class="form-input">
                                <option value="ringan">Ringan (Defisit 300 kcal) - Santai</option>
                                <option value="standar" selected>Standar (Defisit 500 kcal) - Direkomendasikan</option>
                                <option value="agresif">Agresif (Defisit 700 kcal) - Cepat</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-primary mt-6" onclick="calculateAndShowProgram()">
                        <i class="fas fa-magic"></i>
                        Generate Program Diet Saya
                    </button>
                </div>
            </div>

            <!-- STEP 2: Program Timeline -->
            <div class="glass-card section-hidden" id="programSection">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon"><i class="fas fa-route"></i></div>
                        Timeline Program Anda
                    </div>
                    <span class="text-xs font-semibold text-green-600 bg-green-100 px-3 py-1 rounded-full">Aktif</span>
                </div>
                <div class="card-body">
                    
                    <div class="progress-ring">
                        <svg width="200" height="200">
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#2D5A3D"/>
                                    <stop offset="100%" style="stop-color:#D4AF37"/>
                                </linearGradient>
                            </defs>
                            <circle class="progress-ring-bg" cx="100" cy="100" r="88"/>
                            <circle class="progress-ring-fill" id="progressCircle" cx="100" cy="100" r="88" 
                                    stroke-dasharray="553" stroke-dashoffset="553"/>
                        </svg>
                        <div class="progress-content">
                            <div class="progress-percent" id="progressPercent">0%</div>
                            <div class="progress-label">Menuju Target</div>
                        </div>
                    </div>

                    <div class="timeline" id="dietTimeline"></div>

                    <!-- Herbal Product -->
                    <div class="herbal-card">
                        <div class="herbal-header">
                            <div class="herbal-icon-box">
                                <i class="fas fa-capsules"></i>
                            </div>
                            <div>
                                <div class="herbal-title">Suplemen Herbal CALFATLOSS</div>
                                <div class="herbal-subtitle">Formula 5 Herba Aktif Premium (500mg/kapsul)</div>
                            </div>
                        </div>
                        
                        <div class="herbal-grid">
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üçÉ</div>
                                <div class="herbal-item-name">Teh Hijau</div>
                                <div class="herbal-item-dose">170mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üå≥</div>
                                <div class="herbal-item-name">Jati Belanda</div>
                                <div class="herbal-item-dose">120mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üåø</div>
                                <div class="herbal-item-name">Daun Kemuning</div>
                                <div class="herbal-item-dose">110mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">ü´ö</div>
                                <div class="herbal-item-name">Temulawak</div>
                                <div class="herbal-item-dose">50mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üå±</div>
                                <div class="herbal-item-name">Tempuyung</div>
                                <div class="herbal-item-dose">50mg</div>
                            </div>
                        </div>

                        <div class="dosage-box">
                            <div class="dosage-title">
                                <i class="fas fa-clock text-yellow-600 mr-2"></i>
                                Jadwal Konsumsi Optimal (2x3 Kapsul)
                            </div>
                            
                            <div class="dosage-schedule">
                                <span class="dosage-time">
                                    <i class="fas fa-sun text-yellow-500 mr-2"></i>
                                    Pagi (07:00 - 08:00)
                                </span>
                                <span class="dosage-amount">
                                    3 Kapsul<br>
                                    <small>Sesudah Sarapan + Air Hangat</small>
                                </span>
                            </div>
                            
                            <div class="dosage-schedule">
                                <span class="dosage-time">
                                    <i class="fas fa-moon text-blue-500 mr-2"></i>
                                    Malam (18:00 - 19:00)
                                </span>
                                <span class="dosage-amount">
                                    3 Kapsul<br>
                                    <small>Sesudah Makan Malam + Air Putih</small>
                                </span>
                            </div>

                            <div class="dosage-note">
                                <i class="fas fa-info-circle mr-1"></i>
                                <strong>Alternatif:</strong> Bisa juga dikonsumsi 3x2 kapsul (Pagi, Siang, Malam) sesudah makan. 
                                Total 6 kapsul/hari untuk hasil optimal.
                            </div>
                        </div>
                    </div>

                    <!-- Activity Section -->
                    <div class="mt-6 p-4 bg-blue-50 rounded-xl border-l-4 border-blue-500">
                        <h4 class="font-semibold text-blue-800 mb-2 text-sm">
                            <i class="fas fa-running mr-2"></i>Aktivitas Fisik Harian (Minimal 30 Menit)
                        </h4>
                        <p class="text-xs text-blue-700 mb-2"><strong>Disarankan:</strong> Olahraga Lymphatic (Drainase Limfe) & Jalan Kaki.</p>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li><i class="fas fa-check mr-2"></i>Jalan kaki cepat (Brisk Walking)</li>
                            <li><i class="fas fa-check mr-2"></i>Olahraga Lymphatic (Lihat panduan di YouTube)</li>
                            <li><i class="fas fa-check mr-2"></i>Lompat tali (Jump rope)</li>
                            <li><i class="fas fa-check mr-2"></i>Senam aerobik ringan</li>
                        </ul>
                    </div>

                    <button class="btn btn-outline mt-6" onclick="showMealPlan()">
                        Lihat Jadwal Makan Detail
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- STEP 3: Meal Plan & Evaluation -->
            <div class="glass-card section-hidden" id="mealSection">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon"><i class="fas fa-utensils"></i></div>
                        Panduan Menu Harian
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-500">Target Kalori</div>
                        <div class="text-lg font-bold text-green-700" id="mealTargetCal">0 kcal</div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="meal-grid" id="mealContainer"></div>

                    <!-- Alternative Menu Note -->
                    <div class="meal-alternative" style="margin-top: 16px; padding: 16px; background: #FEF3C7; border-radius: 12px; border-left: 4px solid var(--accent-gold);">
                        <div class="meal-alternative-title" style="font-size: 13px; font-weight: 600; color: #92400E; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-lightbulb"></i>
                            Catatan Alternatif Menu
                        </div>
                        <div class="meal-alternative-text" style="font-size: 12px; color: #78350F; line-height: 1.6;">
                            Tidak harus mengikuti menu di atas persis! Yang penting <strong>asupan kalori tetap terjaga</strong> sesuai target. 
                            Anda bisa mengganti dengan makanan lain yang setara kalori dan nutrisinya.
                        </div>
                    </div>

                    <!-- WEEKLY EVALUATION SECTION -->
                    <div class="eval-section" style="margin-top: 32px; border-top: 2px dashed #eee; padding-top: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3 class="font-semibold text-lg" style="color: var(--primary);">
                                <i class="fas fa-clipboard-check mr-2"></i>Evaluasi Mingguan
                            </h3>
                            <span class="text-xs text-gray-500" id="evalWeekLabel">Minggu ke-1</span>
                        </div>

                        <!-- Weight Input -->
                        <div class="calc-grid" style="margin-bottom: 16px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Berat Awal Minggu (kg)</label>
                                <input type="number" id="evalWeightStart" class="form-input" step="0.1" placeholder="70.5">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Berat Akhir Minggu (kg)</label>
                                <input type="number" id="evalWeightEnd" class="form-input" step="0.1" placeholder="69.8" oninput="calculateWeightLoss()">
                            </div>
                        </div>

                        <div class="result-card" style="margin-bottom: 20px; padding: 15px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                            <div style="color: white;">
                                <div style="font-size: 12px; opacity: 0.9;">Hasil Penurunan</div>
                                <div style="font-size: 20px; font-weight: 700;" id="evalLossResult">0 kg</div>
                            </div>
                            <i class="fas fa-weight" style="font-size: 24px; opacity: 0.5;"></i>
                        </div>

                        <!-- Condition Checkboxes -->
                        <div class="form-label" style="margin-bottom: 8px;">Kondisi Tubuh Minggu Ini</div>
                        <div class="check-grid">
                            <label class="check-item">
                                <input type="checkbox" id="cond_energi">
                                <span class="check-box"><i class="fas fa-check" style="font-size: 12px;"></i></span>
                                <span class="check-label">Energi Stabil</span>
                            </label>
                            <label class="check-item">
                                <input type="checkbox" id="cond_nafsu">
                                <span class="check-box"><i class="fas fa-check" style="font-size: 12px;"></i></span>
                                <span class="check-label">Nafsu Makan Terkontrol</span>
                            </label>
                            <label class="check-item">
                                <input type="checkbox" id="cond_efek">
                                <span class="check-box"><i class="fas fa-check" style="font-size: 12px;"></i></span>
                                <span class="check-label">Tidak Ada Efek Samping</span>
                            </label>
                            <label class="check-item">
                                <input type="checkbox" id="cond_tidur">
                                <span class="check-box"><i class="fas fa-check" style="font-size: 12px;"></i></span>
                                <span class="check-label">Tidur Cukup</span>
                            </label>
                        </div>

                        <!-- Issues -->
                        <div class="form-group">
                            <label class="form-label">Apakah ada kendala minggu ini?</label>
                            <textarea id="evalIssues" class="form-input" rows="3" placeholder="Contoh: Sulit menahan ngemil malam, sering kram, dll..."></textarea>
                        </div>

                        <div style="display: flex; gap: 12px; margin-top: 20px;" class="no-print">
                            <button class="btn btn-outline" style="flex: 1;" onclick="saveEvaluation()">
                                <i class="fas fa-save"></i> Simpan
                            </button>
                            <button class="btn btn-primary" style="flex: 1;" onclick="printEvaluation()">
                                <i class="fas fa-print"></i> Cetak PDF
                            </button>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Konsultasi Footer -->
            <div class="footer-info no-print">
                <h4>Butuh Bantuan Konsultasi?</h4>
                <p>Jika Anda mengalami kendala atau membutuhkan pendampingan lebih lanjut, hubungi ahli gizi kami.</p>
                <a href="https://wa.me/6281546450547?text=Halo%20Admin%20Calfatloss%2C%20saya%20butuh%20konsultasi%20terkait%20program%20diet." target="_blank" class="btn btn-gold" style="width: 100%; max-width: 300px; margin: 0 auto;">
                    <i class="fab fa-whatsapp"></i> Hubungi via WhatsApp
                </a>
            </div>

            <!-- Footer -->
            <footer class="text-center text-gray-400 text-xs mt-8 pb-8 no-print">
                <p class="mb-2">CALFATLOSS - Smart Nutrition System</p>
                <p>Hasil estimasi, konsultasikan dengan ahli gizi untuk kondisi khusus</p>
            </footer>

        </div>
    </div>

    <script>
        // ==================================================
        // LOGIKA AKSES & VERIFIKASI (POINT 7)
        // ==================================================
        const LOGIN_URL = '/log-aktivitas.html'; 
        let currentCode = null;

        function checkAccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const codeFromUrl = urlParams.get('kode');
            const codeFromSession = sessionStorage.getItem('calfatloss_active_code');

            if (codeFromUrl) {
                currentCode = codeFromUrl.toUpperCase();
                sessionStorage.setItem('calfatloss_active_code', currentCode);
                initializeApp();
            } else if (codeFromSession) {
                currentCode = codeFromSession;
                initializeApp();
            } else {
                window.location.href = LOGIN_URL;
            }
        }

        // Run access check immediately
        checkAccess();

        // ==================================================
        // DATA & STATE MANAGEMENT (POINT 2)
        // ==================================================
        
        let userData = {
            nama: '', gender: '', usia: 0, berat: 0, tinggi: 0, aktivitas: 0, target: 0, metode: 'standar',
            bmr: 0, tdee: 0, dietCal: 0, weeks: 0, protein: 0, lemak: 0, karbo: 0,
            startDate: null
        };

        let weeklyEval = {
            start: 0, end: 0, loss: 0,
            conditions: { energi: false, nafsu: false, efek: false, tidur: false },
            issues: ""
        };

        function initializeApp() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('userCodeDisplay').textContent = `Kode: ${currentCode}`;
            loadUserData();
        }

        function loadUserData() {
            const storageKey = `calfatloss_data_${currentCode}`;
            const saved = localStorage.getItem(storageKey);
            
            if (saved) {
                const data = JSON.parse(saved);
                userData = data;

                // Fill inputs
                if (data.nama) document.getElementById('inputNama').value = data.nama;
                if (data.gender) document.getElementById('inputGender').value = data.gender;
                if (data.usia) document.getElementById('inputUsia').value = data.usia;
                if (data.berat) document.getElementById('inputBerat').value = data.berat;
                if (data.tinggi) document.getElementById('inputTinggi').value = data.tinggi;
                if (data.aktivitas) document.getElementById('inputAktivitas').value = data.aktivitas;
                if (data.target) document.getElementById('inputTarget').value = data.target;
                if (data.metode) document.getElementById('inputMetode').value = data.metode;

                // Load evaluation if exists
                if(data.lastEval) {
                    weeklyEval = data.lastEval;
                    document.getElementById('evalWeightStart').value = weeklyEval.start;
                    document.getElementById('evalWeightEnd').value = weeklyEval.end;
                    document.getElementById('evalIssues').value = weeklyEval.issues;
                    document.getElementById('cond_energi').checked = weeklyEval.conditions.energi;
                    document.getElementById('cond_nafsu').checked = weeklyEval.conditions.nafsu;
                    document.getElementById('cond_efek').checked = weeklyEval.conditions.efek;
                    document.getElementById('cond_tidur').checked = weeklyEval.conditions.tidur;
                    calculateWeightLoss();
                }
                
                // If data complete, show program
                if (data.nama && data.gender && data.dietCal > 0) {
                    updateCalculatorUI();
                    generateTimeline();
                    generateMealPlan();
                    document.getElementById('programSection').classList.remove('section-hidden');
                    document.getElementById('programSection').classList.add('section-visible');
                }
            }
        }

        function saveUserData() {
            const storageKey = `calfatloss_data_${currentCode}`;
            localStorage.setItem(storageKey, JSON.stringify(userData));
        }

        function saveEvaluation() {
            weeklyEval.start = parseFloat(document.getElementById('evalWeightStart').value) || 0;
            weeklyEval.end = parseFloat(document.getElementById('evalWeightEnd').value) || 0;
            weeklyEval.issues = document.getElementById('evalIssues').value;
            weeklyEval.conditions = {
                energi: document.getElementById('cond_energi').checked,
                nafsu: document.getElementById('cond_nafsu').checked,
                efek: document.getElementById('cond_efek').checked,
                tidur: document.getElementById('cond_tidur').checked
            };
            
            userData.lastEval = weeklyEval;
            saveUserData();
            alert('Evaluasi mingguan tersimpan!');
        }

        // ==================================================
        // CALCULATOR LOGIC (POINT 3)
        // ==================================================
        const deficitMap = { 'ringan': 300, 'standar': 500, 'agresif': 700 };

        function updateActivityInfo() {
            const val = document.getElementById('inputAktivitas').value;
            const infoBox = document.getElementById('activityInfo');
            let text = "";
            if(val === "1.2") text = "Hampir tidak ada olahraga, banyak duduk.";
            else if(val === "1.375") text = "Olahraga ringan 1-3 hari per minggu.";
            else if(val === "1.55") text = "Olahraga sedang 3-5 hari per minggu.";
            else if(val === "1.725") text = "Olahraga berat 6-7 hari per minggu.";
            
            if(text) {
                infoBox.textContent = text;
                infoBox.style.display = 'block';
            } else {
                infoBox.style.display = 'none';
            }
        }

        function calculateBMR(gender, weight, height, age) {
            if (gender === 'pria') {
                return (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                return (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }
        }

        function calculateAndShowProgram() {
            userData.nama = document.getElementById('inputNama').value;
            userData.gender = document.getElementById('inputGender').value;
            userData.usia = parseFloat(document.getElementById('inputUsia').value);
            userData.berat = parseFloat(document.getElementById('inputBerat').value);
            userData.tinggi = parseFloat(document.getElementById('inputTinggi').value);
            userData.aktivitas = parseFloat(document.getElementById('inputAktivitas').value);
            userData.target = parseFloat(document.getElementById('inputTarget').value);
            userData.metode = document.getElementById('inputMetode').value;
            userData.startDate = new Date().toISOString(); // Save start date

            if (!userData.nama || !userData.gender || !userData.usia || !userData.berat || !userData.tinggi || !userData.aktivitas || !userData.target) {
                alert('Mohon lengkapi semua data terlebih dahulu');
                return;
            }

            if (userData.target >= userData.berat) {
                alert('Target berat harus lebih rendah dari berat saat ini');
                return;
            }

            // Calculations
            userData.bmr = calculateBMR(userData.gender, userData.berat, userData.tinggi, userData.usia);
            userData.tdee = userData.bmr * userData.aktivitas;
            
            const deficit = deficitMap[userData.metode];
            userData.dietCal = Math.max(1200, userData.tdee - deficit);
            
            const weeklyLoss = (deficit * 7) / 7700;
            userData.weeks = Math.ceil((userData.berat - userData.target) / weeklyLoss);

            // Macros
            const proteinMult = userData.metode === 'agresif' ? 2.2 : (userData.metode === 'ringan' ? 1.8 : 2.0);
            userData.protein = userData.berat * proteinMult;
            userData.lemak = userData.berat * 0.8;
            userData.karbo = (userData.dietCal - (userData.protein * 4) - (userData.lemak * 9)) / 4;

            saveUserData();
            updateCalculatorUI();
            generateTimeline();
            generateMealPlan();
            
            document.getElementById('programSection').classList.remove('section-hidden');
            document.getElementById('programSection').classList.add('section-visible');
            
            setTimeout(() => {
                document.getElementById('programSection').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function updateCalculatorUI() {
            document.getElementById('quickResults').style.display = 'grid';
            document.getElementById('previewCalories').textContent = Math.round(userData.dietCal);
            document.getElementById('previewWeeks').textContent = userData.weeks;
            document.getElementById('previewTarget').textContent = userData.target;
            
            document.getElementById('heroWeeks').textContent = userData.weeks;
            document.getElementById('heroLoss').textContent = userData.metode === 'agresif' ? '0.7-1' : (userData.metode === 'ringan' ? '0.3-0.5' : '0.5-0.7');

            // Date Estimation (Point 3)
            if(userData.startDate) {
                const start = new Date(userData.startDate);
                const end = new Date(start);
                end.setDate(start.getDate() + (userData.weeks * 7));
                
                const options = { day: 'numeric', month: 'short', year: 'numeric' };
                document.getElementById('previewDate').textContent = end.toLocaleDateString('id-ID', options);
                document.getElementById('previewDateRelative').textContent = `${userData.weeks} minggu dari sekarang`;
            }

            // Macro Bars Animation
            const totalMacroGrams = userData.protein + userData.lemak + userData.karbo;
            const pctP = (userData.protein / totalMacroGrams) * 100;
            const pctL = (userData.lemak / totalMacroGrams) * 100;
            const pctK = (userData.karbo / totalMacroGrams) * 100;

            const pctCalP = ((userData.protein * 4) / userData.dietCal) * 100;
            const pctCalL = ((userData.lemak * 9) / userData.dietCal) * 100;
            const pctCalK = ((userData.karbo * 4) / userData.dietCal) * 100;

            document.getElementById('barProtein').style.width = pctCalP + '%';
            document.getElementById('barLemak').style.width = pctCalL + '%';
            document.getElementById('barKarbo').style.width = pctCalK + '%';

            document.getElementById('pctProtein').textContent = Math.round(pctCalP);
            document.getElementById('pctLemak').textContent = Math.round(pctCalL);
            document.getElementById('pctKarbo').textContent = Math.round(pctCalK);
        }

        function generateTimeline() {
            const timeline = document.getElementById('dietTimeline');
            timeline.innerHTML = '';

            const phases = [
                { week: 1, title: 'Fase Detox & Adaptasi', desc: 'Mulai konsumsi herbal. Fokus olahraga lymphatic & jalan kaki.' },
                { week: Math.round(userData.weeks * 0.25), title: 'Fase Pembakaran Awal', desc: 'Metabolisme meningkat. Jaga asupan air putih.' },
                { week: Math.round(userData.weeks * 0.5), title: 'Fase Peak Metabolism', desc: 'Tubuh beradaptasi dengan defisit. Pastikan tidur cukup.' },
                { week: userData.weeks, title: 'Target Tercapai!', desc: `Selamat ${userData.nama}! Masuk fase maintenance.` }
            ];
            
             const filteredPhases = phases.filter((phase, index, self) =>
                index === self.findIndex((t) => t.week === phase.week)
            );

            filteredPhases.forEach((phase, index) => {
                const isLast = index === filteredPhases.length - 1;
                const dotClass = isLast ? 'active' : '';
                
                timeline.innerHTML += `
                    <div class="timeline-item">
                        <div class="timeline-dot ${dotClass}">${isLast ? '<i class="fas fa-flag"></i>' : phase.week}</div>
                        <div class="timeline-content">
                            <h4>${phase.title}</h4>
                            <p>${phase.desc}</p>
                        </div>
                    </div>`;
            });

            // Animate Progress
            setTimeout(() => {
                const circle = document.getElementById('progressCircle');
                const radius = circle.r.baseVal.value;
                const circumference = radius * 2 * Math.PI;
                const offset = circumference - (10/100) * circumference;
                circle.style.strokeDashoffset = offset;
                document.getElementById('progressPercent').textContent = '10%';
            }, 500);
        }

        // ==================================================
        // MEAL PLAN (POINT 4)
        // ==================================================
        function generateMealPlan() {
            const container = document.getElementById('mealContainer');
            document.getElementById('mealTargetCal').textContent = Math.round(userData.dietCal) + ' kcal';
            
            const meals = [
                { time: '07:00', title: 'Sarapan (25%)', cal: Math.round(userData.dietCal * 0.25), 
                  menu: `Telur Rebus 2 butir + Pisang 1 buah + 3 kapsul herbal sesudah makan` },
                { time: '10:00', title: 'Snack Pagi (10%)', cal: Math.round(userData.dietCal * 0.10), 
                  menu: `Buah segar (apel/jeruk) + kacang almond 10 butir` },
                { time: '12:00', title: 'Makan Siang (30%)', cal: Math.round(userData.dietCal * 0.30), 
                  menu: `Nasi merah 100g + dada ayam 150g + sayur tumis` },
                { time: '15:00', title: 'Snack Sore (10%)', cal: Math.round(userData.dietCal * 0.10), 
                  menu: `Yogurt plain + granola atau smoothie green` },
                { time: '18:00', title: 'Makan Malam (25%)', cal: Math.round(userData.dietCal * 0.25), 
                  menu: `Ikan kukus 150g + salad sayur + kentang rebus + 3 kapsul herbal sesudah makan` }
            ];

            container.innerHTML = meals.map(meal => `
                <div class="meal-card">
                    <div class="meal-time-box">
                        <div class="meal-time-label">JAM</div>
                        <div class="meal-time-value">${meal.time}</div>
                    </div>
                    <div class="meal-content">
                        <div class="meal-title">${meal.title}</div>
                        <div class="meal-desc">${meal.menu}</div>
                    </div>
                    <div class="meal-cal">~${meal.cal}<br><small>kcal</small></div>
                </div>
            `).join('');
        }

        // ==================================================
        // EVALUATION LOGIC (POINT 5)
        // ==================================================
        function calculateWeightLoss() {
            const start = parseFloat(document.getElementById('evalWeightStart').value) || 0;
            const end = parseFloat(document.getElementById('evalWeightEnd').value) || 0;
            const loss = (start - end).toFixed(1);
            
            const resultEl = document.getElementById('evalLossResult');
            resultEl.textContent = `${loss} kg`;
            
            if (loss > 0) {
                resultEl.style.color = '#d1fae5'; // greenish
                resultEl.innerHTML = `-${loss} kg <i class="fas fa-arrow-down ml-2"></i>`;
            } else if (loss < 0) {
                resultEl.style.color = '#fecaca'; // reddish
                resultEl.innerHTML = `${loss} kg <i class="fas fa-arrow-up ml-2"></i>`;
            } else {
                resultEl.style.color = 'white';
                resultEl.innerHTML = `0 kg`;
            }
        }

        function printEvaluation() {
            saveEvaluation();
            window.print();
        }

        function showMealPlan() {
            document.getElementById('mealSection').classList.remove('section-hidden');
            document.getElementById('mealSection').classList.add('section-visible');
            
            setTimeout(() => {
                document.getElementById('mealSection').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // Auto-save inputs
        ['inputNama', 'inputGender', 'inputUsia', 'inputBerat', 'inputTinggi', 'inputAktivitas', 'inputTarget', 'inputMetode'].forEach(id => {
            document.getElementById(id)?.addEventListener('change', () => {
                if (currentCode) {
                    userData.nama = document.getElementById('inputNama').value;
                    userData.gender = document.getElementById('inputGender').value;
                    userData.usia = parseFloat(document.getElementById('inputUsia').value) || 0;
                    userData.berat = parseFloat(document.getElementById('inputBerat').value) || 0;
                    userData.tinggi = parseFloat(document.getElementById('inputTinggi').value) || 0;
                    userData.aktivitas = parseFloat(document.getElementById('inputAktivitas').value) || 0;
                    userData.target = parseFloat(document.getElementById('inputTarget').value) || 0;
                    userData.metode = document.getElementById('inputMetode').value;
                    saveUserData();
                }
            });
        });
    </script>
</body>
</html>
