<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CALFATLOSS - Program Diet Herbal Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2D5A3D;
            --primary-light: #3F7A52;
            --primary-dark: #1E3D28;
            --accent-gold: #D4AF37;
            --accent-gold-light: #F4E4C1;
            --bg-cream: #FAF8F3;
            --bg-light: #F5F2EC;
            --text-dark: #1A1A1A;
            --text-muted: #6B6B6B;
            --success: #22C55E;
            --warning: #F59E0B;
            --danger: #EF4444;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.12);
            --radius: 20px;
            --radius-sm: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-cream);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .font-display {
            font-family: 'Playfair Display', serif;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-light);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse-gold {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
            50% { box-shadow: 0 0 0 15px rgba(212, 175, 55, 0); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .animate-fade-in {
            animation: fadeInUp 0.6s ease forwards;
        }
        
        .delay-100 { animation-delay: 0.1s; opacity: 0; }
        .delay-200 { animation-delay: 0.2s; opacity: 0; }
        .delay-300 { animation-delay: 0.3s; opacity: 0; }

        .hero-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            position: relative;
            overflow: hidden;
            padding: 60px 24px 80px;
        }

        .hero-pattern {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            color: var(--accent-gold-light);
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .hero-title {
            font-size: 36px;
            font-weight: 700;
            color: white;
            line-height: 1.2;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .hero-subtitle {
            font-size: 15px;
            color: rgba(255,255,255,0.8);
            font-weight: 300;
            margin-bottom: 32px;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 32px;
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-gold);
        }

        .hero-stat-label {
            font-size: 11px;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .main-container {
            max-width: 800px;
            margin: -40px auto 0;
            padding: 0 20px 60px;
            position: relative;
            z-index: 10;
        }

        .glass-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin-bottom: 24px;
            border: 1px solid rgba(0,0,0,0.04);
        }

        .card-header {
            padding: 24px;
            border-bottom: 1px solid rgba(0,0,0,0.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .card-body {
            padding: 24px;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 640px) {
            .calc-grid {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            background: var(--bg-light);
            border: 2px solid transparent;
            border-radius: var(--radius-sm);
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            background: white;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 4px rgba(45, 90, 61, 0.1);
        }

        select.form-input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%236B6B6B' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            cursor: pointer;
        }

        .activity-desc {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
            font-style: italic;
        }

        .results-dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .result-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: var(--radius-sm);
            padding: 20px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .result-card.accent {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #B8941F 100%);
        }

        .result-label {
            font-size: 11px;
            font-weight: 500;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .result-value {
            font-size: 32px;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 4px;
        }

        .result-unit {
            font-size: 12px;
            opacity: 0.8;
        }

        .timeline {
            position: relative;
            padding-left: 32px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 11px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--primary), var(--accent-gold));
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px dashed rgba(0,0,0,0.1);
        }

        .timeline-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .timeline-dot {
            position: absolute;
            left: -32px;
            top: 4px;
            width: 24px;
            height: 24px;
            background: white;
            border: 3px solid var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: var(--primary);
        }

        .timeline-dot.active {
            background: var(--primary);
            color: white;
            animation: pulse-gold 2s infinite;
        }

        .timeline-dot.completed {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .timeline-content h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .timeline-content p {
            font-size: 13px;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .herbal-card {
            background: linear-gradient(135deg, #F0F7F2 0%, #E8F5E9 100%);
            border: 1px solid #C8E6C9;
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-top: 16px;
        }

        .herbal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .herbal-icon-box {
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            font-size: 20px;
            color: var(--primary);
        }

        .herbal-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .herbal-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        .herbal-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        @media (min-width: 768px) {
            .herbal-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        .herbal-item {
            background: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s ease;
        }

        .herbal-item:hover {
            transform: translateY(-2px);
        }

        .herbal-item-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .herbal-item-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .herbal-item-dose {
            font-size: 11px;
            color: var(--text-muted);
        }

        .dosage-box {
            background: white;
            border-radius: 10px;
            padding: 16px;
            border-left: 4px solid var(--accent-gold);
        }

        .dosage-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .dosage-schedule {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .dosage-schedule:last-child {
            border-bottom: none;
        }

        .dosage-time {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
        }

        .dosage-amount {
            font-size: 12px;
            color: var(--text-muted);
            text-align: right;
        }

        .dosage-note {
            margin-top: 12px;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 8px;
            font-size: 11px;
            color: var(--text-muted);
            font-style: italic;
        }

        .meal-grid {
            display: grid;
            gap: 16px;
        }

        .meal-card {
            background: var(--bg-light);
            border-radius: var(--radius-sm);
            padding: 16px;
            display: flex;
            gap: 16px;
            align-items: center;
            transition: all 0.3s ease;
        }

        .meal-card:hover {
            transform: translateX(4px);
            background: white;
            box-shadow: var(--shadow-md);
        }

        .meal-time-box {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            flex-shrink: 0;
            border: 2px solid var(--primary);
        }

        .meal-time-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meal-time-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
            margin-top: 2px;
        }

        .meal-content {
            flex: 1;
        }

        .meal-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .meal-desc {
            font-size: 12px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .meal-cal {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
            white-space: nowrap;
        }

        .meal-alternative {
            margin-top: 16px;
            padding: 16px;
            background: #FEF3C7;
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--accent-gold);
        }

        .meal-alternative-title {
            font-size: 13px;
            font-weight: 600;
            color: #92400E;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .meal-alternative-text {
            font-size: 12px;
            color: #78350F;
            line-height: 1.6;
        }

        .progress-ring {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 24px;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
        }

        .progress-ring-bg {
            fill: none;
            stroke: var(--bg-light);
            stroke-width: 12;
        }

        .progress-ring-fill {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }

        .progress-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-percent {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }

        .progress-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .btn {
            width: 100%;
            padding: 16px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'Poppins', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(45, 90, 61, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(45, 90, 61, 0.4);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #B8941F 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(212, 175, 55, 0.3);
            animation: pulse-gold 2s infinite;
        }

        .btn-outline {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (min-width: 768px) {
            .tips-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .tip-card {
            background: white;
            border-radius: var(--radius-sm);
            padding: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0,0,0,0.04);
        }

        .tip-icon {
            width: 36px;
            height: 36px;
            background: var(--bg-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .tip-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .tip-desc {
            font-size: 11px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .consultation-card {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            border-radius: var(--radius);
            padding: 32px 24px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .consultation-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        .consultation-badge {
            display: inline-block;
            padding: 6px 16px;
            background: var(--accent-gold);
            color: white;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .consultation-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
            position: relative;
        }

        .consultation-desc {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 24px;
            position: relative;
        }

        .section-hidden {
            display: none;
        }

        .section-visible {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        /* Weekly Evaluation Styles */
        .weekly-eval-form {
            background: var(--bg-light);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 20px;
        }

        .weekly-eval-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        @media (max-width: 640px) {
            .weekly-eval-grid {
                grid-template-columns: 1fr;
            }
        }

        .condition-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
        }

        @media (max-width: 640px) {
            .condition-grid {
                grid-template-columns: 1fr;
            }
        }

        .condition-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .condition-item:hover {
            border-color: var(--primary-light);
        }

        .condition-item.checked {
            background: #E8F5E9;
            border-color: var(--primary);
        }

        .condition-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .condition-item.checked .condition-checkbox {
            background: var(--primary);
            color: white;
        }

        .condition-text {
            font-size: 13px;
            font-weight: 500;
        }

        .obstacle-section {
            margin-top: 20px;
        }

        .obstacle-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid transparent;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
            resize: vertical;
            min-height: 80px;
        }

        .obstacle-textarea:focus {
            outline: none;
            border-color: var(--primary-light);
        }

        .weekly-result {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--accent-gold);
        }

        .weekly-result-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .weekly-result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            font-size: 13px;
        }

        .weekly-result-item:last-child {
            border-bottom: none;
            font-weight: 600;
            color: var(--primary);
        }

        .date-estimate {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            color: white;
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-top: 16px;
            text-align: center;
        }

        .date-estimate-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .date-estimate-value {
            font-size: 18px;
            font-weight: 700;
        }

        /* Access Denied / Redirect Message */
        .access-message {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-cream);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }

        .access-content {
            text-align: center;
            max-width: 400px;
        }

        .access-icon {
            font-size: 64px;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .access-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .access-desc {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; }
            .glass-card { box-shadow: none; border: 1px solid #ddd; }
        }

        @media (min-width: 768px) {
            .hero-title { font-size: 48px; }
            .main-container { padding: 0 40px 60px; }
        }

        @media (prefers-reduced-motion: reduce) {
            * { animation-duration: 0.01ms !important; }
        }
    </style>
</head>
<body>

    <!-- Access Check Layer -->
    <div id="accessCheck" style="display: none;">
        <div class="access-message">
            <div class="access-content">
                <div class="access-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h2 class="access-title">Memeriksa Akses...</h2>
                <p class="access-desc">Mohon tunggu sebentar</p>
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-700 mx-auto"></div>
            </div>
        </div>
    </div>

    <!-- Access Denied Layer -->
    <div id="accessDenied" style="display: none;">
        <div class="access-message">
            <div class="access-content">
                <div class="access-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <h2 class="access-title">Akses Ditolak</h2>
                <p class="access-desc">Anda perlu verifikasi kode konsultasi terlebih dahulu di halaman Log Aktivitas.</p>
                <button onclick="goToLogin()" class="btn btn-primary mt-4" style="width: auto; padding: 12px 24px;">
                    Ke Halaman Verifikasi
                </button>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden until code verified) -->
    <div id="mainApp" class="section-hidden">
        
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-pattern"></div>
            <div class="hero-content">
                <div class="hero-badge">
                    <i class="fas fa-leaf"></i>
                    Program Diet Herbal Premium
                </div>
                <h1 class="hero-title font-display">Transformasi Tubuh Alami</h1>
                <p class="hero-subtitle">Gabungan sains nutrisi modern & kearifan lokal herbal untuk penurunan berat badan optimal</p>
                
                <div class="hero-stats">
                    <div class="hero-stat">
                        <div class="hero-stat-value" id="heroWeeks">12</div>
                        <div class="hero-stat-label">Minggu Program</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value" id="heroLoss">0.5-1</div>
                        <div class="hero-stat-label">Kg/Minggu</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value">5</div>
                        <div class="hero-stat-label">Herba Aktif</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Container -->
        <div class="main-container">

            <!-- STEP 1: Kalkulator -->
            <div class="glass-card animate-fade-in delay-100" id="calculatorSection">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon"><i class="fas fa-calculator"></i></div>
                        Kalkulator Diet Cerdas
                    </div>
                    <span class="text-xs text-gray-500" id="userCodeDisplay">Kode: -</span>
                </div>
                <div class="card-body">
                    <div class="results-dashboard" id="quickResults" style="display: none;">
                        <div class="result-card">
                            <div class="result-label">Kalori Harian</div>
                            <div class="result-value" id="previewCalories">0</div>
                            <div class="result-unit">kcal</div>
                        </div>
                        <div class="result-card accent">
                            <div class="result-label">Target Turun</div>
                            <div class="result-value" id="previewWeeks">0</div>
                            <div class="result-unit">minggu</div>
                        </div>
                    </div>

                    <!-- Date Estimate Display -->
                    <div class="date-estimate" id="dateEstimate" style="display: none;">
                        <div class="date-estimate-label">Estimasi Tercapai</div>
                        <div class="date-estimate-value" id="targetDateDisplay">-</div>
                    </div>

                    <div class="calc-grid">
                        <div class="form-group">
                            <label class="form-label">Nama Lengkap</label>
                            <input type="text" id="inputNama" class="form-input" placeholder="Masukkan nama">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Jenis Kelamin</label>
                            <select id="inputGender" class="form-input">
                                <option value="">Pilih Gender</option>
                                <option value="pria">Laki-laki</option>
                                <option value="wanita">Perempuan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Usia (tahun)</label>
                            <input type="number" id="inputUsia" class="form-input" placeholder="25" min="15" max="80">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Berat Badan (kg)</label>
                            <input type="number" id="inputBerat" class="form-input" placeholder="70" min="30" max="200" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tinggi Badan (cm)</label>
                            <input type="number" id="inputTinggi" class="form-input" placeholder="165" min="100" max="250">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Aktivitas Harian</label>
                            <select id="inputAktivitas" class="form-input">
                                <option value="">Pilih Level</option>
                                <option value="1.2">Sedentari (Jarang Bergerak) - 1.2</option>
                                <option value="1.375">Ringan (1-2x Olahraga/Minggu) - 1.375</option>
                                <option value="1.55">Sedang (3-5x Olahraga/Minggu) - 1.55</option>
                                <option value="1.725">Berat (6-7x Olahraga/Minggu) - 1.725</option>
                                <option value="1.9">Sangat Berat (Pekerja Fisik/Atlet) - 1.9</option>
                            </select>
                            <p class="activity-desc" id="activityDesc">Pilih level aktivitas untuk melihat keterangan</p>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Target Berat (kg)</label>
                            <input type="number" id="inputTarget" class="form-input" placeholder="60" min="30" max="200" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Kecepatan Diet</label>
                            <select id="inputMetode" class="form-input">
                                <option value="ringan">Ringan (300 kcal defisit)</option>
                                <option value="standar" selected>Standar (500 kcal defisit)</option>
                                <option value="agresif">Agresif (700 kcal defisit)</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-primary mt-6" onclick="calculateAndShowProgram()">
                        <i class="fas fa-magic"></i>
                        Generate Program Diet Saya
                    </button>
                </div>
            </div>

            <!-- STEP 2: Program Timeline -->
            <div class="glass-card section-hidden" id="programSection">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon"><i class="fas fa-route"></i></div>
                        Timeline Program Anda
                    </div>
                    <span class="text-xs font-semibold text-green-600 bg-green-100 px-3 py-1 rounded-full">Aktif</span>
                </div>
                <div class="card-body">
                    
                    <div class="progress-ring">
                        <svg width="200" height="200">
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#2D5A3D"/>
                                    <stop offset="100%" style="stop-color:#D4AF37"/>
                                </linearGradient>
                            </defs>
                            <circle class="progress-ring-bg" cx="100" cy="100" r="88"/>
                            <circle class="progress-ring-fill" id="progressCircle" cx="100" cy="100" r="88" 
                                    stroke-dasharray="553" stroke-dashoffset="553"/>
                        </svg>
                        <div class="progress-content">
                            <div class="progress-percent" id="progressPercent">0%</div>
                            <div class="progress-label">Menuju Target</div>
                        </div>
                    </div>

                    <div class="timeline" id="dietTimeline">
                        <!-- Generated by JS -->
                    </div>

                    <!-- Herbal Product -->
                    <div class="herbal-card">
                        <div class="herbal-header">
                            <div class="herbal-icon-box">
                                <i class="fas fa-capsules"></i>
                            </div>
                            <div>
                                <div class="herbal-title">Suplemen Herbal CALFATLOSS</div>
                                <div class="herbal-subtitle">Formula 5 Herba Aktif Premium (500mg/kapsul)</div>
                            </div>
                        </div>
                        
                        <div class="herbal-grid">
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üçÉ</div>
                                <div class="herbal-item-name">Teh Hijau</div>
                                <div class="herbal-item-dose">170mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üå≥</div>
                                <div class="herbal-item-name">Jati Belanda</div>
                                <div class="herbal-item-dose">120mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üåø</div>
                                <div class="herbal-item-name">Daun Kemuning</div>
                                <div class="herbal-item-dose">110mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">ü´ö</div>
                                <div class="herbal-item-name">Temulawak</div>
                                <div class="herbal-item-dose">50mg</div>
                            </div>
                            <div class="herbal-item">
                                <div class="herbal-item-icon">üå±</div>
                                <div class="herbal-item-name">Tempuyung</div>
                                <div class="herbal-item-dose">50mg</div>
                            </div>
                        </div>

                        <div class="dosage-box">
                            <div class="dosage-title">
                                <i class="fas fa-clock text-yellow-600 mr-2"></i>
                                Jadwal Konsumsi Optimal (2x3 Kapsul)
                            </div>
                            
                            <div class="dosage-schedule">
                                <span class="dosage-time">
                                    <i class="fas fa-sun text-yellow-500 mr-2"></i>
                                    Pagi (07:00 - 08:00)
                                </span>
                                <span class="dosage-amount">
                                    3 Kapsul<br>
                                    <small>Sesudah Sarapan + Air Hangat</small>
                                </span>
                            </div>
                            
                            <div class="dosage-schedule">
                                <span class="dosage-time">
                                    <i class="fas fa-moon text-blue-500 mr-2"></i>
                                    Malam (18:00 - 19:00)
                                </span>
                                <span class="dosage-amount">
                                    3 Kapsul<br>
                                    <small>Sesudah Makan Malam + Air Putih</small>
                                </span>
                            </div>

                            <div class="dosage-note">
                                <i class="fas fa-info-circle mr-1"></i>
                                <strong>Alternatif:</strong> Bisa juga dikonsumsi 3x2 kapsul (Pagi, Siang, Malam) sesudah makan. 
                                Total 6 kapsul/hari untuk hasil optimal.
                            </div>
                        </div>
                    </div>

                    <!-- Activity Section - Updated with Lymphatic -->
                    <div class="mt-6 p-4 bg-blue-50 rounded-xl border-l-4 border-blue-500">
                        <h4 class="font-semibold text-blue-800 mb-3 text-sm">
                            <i class="fas fa-running mr-2"></i>Aktivitas Fisik Harian (Minimal 30 Menit)
                        </h4>
                        <div class="space-y-3">
                            <div class="bg-white p-3 rounded-lg">
                                <div class="flex items-center gap-2 mb-1">
                                    <i class="fas fa-star text-yellow-500"></i>
                                    <span class="font-semibold text-sm text-blue-900">Direkomendasikan:</span>
                                </div>
                                <ul class="text-sm text-blue-700 space-y-1 ml-6">
                                    <li><i class="fas fa-check text-green-500 mr-2"></i><strong>Latihan Lymphatic</strong> - Pernapasan diafragma, shoulder rolls, neck rolls (lihat tutorial di YouTube: "lymphatic drainage exercise")</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i><strong>Jalan Kaki Cepat</strong> (Brisk Walking) - 30-45 menit</li>
                                </ul>
                            </div>
                            <div class="text-sm text-blue-700">
                                <strong>Alternatif:</strong> Lompat tali, jumping jack, atau berenang. Hindari olahraga berat tanpa pemanasan.
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-outline mt-6" onclick="showMealPlan()">
                        Lihat Jadwal Makan Detail
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- STEP 3: Meal Plan -->
            <div class="glass-card section-hidden" id="mealSection">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon"><i class="fas fa-utensils"></i></div>
                        Panduan Menu Harian
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-500">Target Kalori</div>
                        <div class="text-lg font-bold text-green-700" id="mealTargetCal">0 kcal</div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="meal-grid" id="mealContainer">
                        <!-- Generated by JS -->
                    </div>

                    <!-- Alternative Menu Note -->
                    <div class="meal-alternative">
                        <div class="meal-alternative-title">
                            <i class="fas fa-lightbulb"></i>
                            Catatan Alternatif Menu
                        </div>
                        <div class="meal-alternative-text">
                            Tidak harus mengikuti menu di atas persis! Yang penting <strong>asupan kalori tetap terjaga</strong> sesuai target. 
                            Anda bisa mengganti dengan makanan lain yang setara kalori dan nutrisinya. Contoh: Nasi bisa diganti roti gandum, 
                            ayam bisa diganti ikan atau tahu/tempe. Yang terpenting adalah <strong>defisit kalori dan konsistensi minum herbal</strong>.
                        </div>
                    </div>

                    <!-- Weekly Evaluation Section (Replaced Daily) -->
                    <div class="eval-section" id="weeklyEvalSection">
                        <div class="flex items-center justify-between mb-4">
                            <div class="eval-title">
                                <i class="fas fa-clipboard-check mr-2 text-green-600"></i>
                                Evaluasi Mingguan
                            </div>
                            <div class="text-sm text-gray-500" id="evalWeekDisplay">Minggu ke-1</div>
                        </div>

                        <div class="weekly-eval-form">
                            <div class="weekly-eval-grid">
                                <div class="form-group">
                                    <label class="form-label">Berat Awal Minggu (kg)</label>
                                    <input type="number" id="weekStartWeight" class="form-input" step="0.1" placeholder="0.0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Berat Akhir Minggu (kg)</label>
                                    <input type="number" id="weekEndWeight" class="form-input" step="0.1" placeholder="0.0" onchange="calculateWeeklyLoss()">
                                </div>
                            </div>

                            <div class="weekly-result" id="weeklyResult" style="display: none;">
                                <div class="weekly-result-title">Hasil Minggu Ini</div>
                                <div class="weekly-result-item">
                                    <span>Penurunan Berat:</span>
                                    <span id="weightLossValue">0 kg</span>
                                </div>
                            </div>

                            <div class="mt-4">
                                <label class="form-label">Kondisi Tubuh (Centang yang sesuai)</label>
                                <div class="condition-grid">
                                    <div class="condition-item" onclick="toggleCondition(this, 'energi')">
                                        <div class="condition-checkbox"><i class="fas fa-check text-xs"></i></div>
                                        <span class="condition-text">Energi Stabil</span>
                                    </div>
                                    <div class="condition-item" onclick="toggleCondition(this, 'nafsu')">
                                        <div class="condition-checkbox"><i class="fas fa-check text-xs"></i></div>
                                        <span class="condition-text">Nafsu Makan Terkontrol</span>
                                    </div>
                                    <div class="condition-item" onclick="toggleCondition(this, 'efek')">
                                        <div class="condition-checkbox"><i class="fas fa-check text-xs"></i></div>
                                        <span class="condition-text">Tidak Ada Efek Samping</span>
                                    </div>
                                    <div class="condition-item" onclick="toggleCondition(this, 'tidur')">
                                        <div class="condition-checkbox"><i class="fas fa-check text-xs"></i></div>
                                        <span class="condition-text">Tidur Cukup (7-8 jam)</span>
                                    </div>
                                </div>
                            </div>

                            <div class="obstacle-section">
                                <label class="form-label">Ada kendala minggu ini?</label>
                                <textarea id="weeklyObstacle" class="obstacle-textarea" placeholder="Ceritakan kendala atau tantangan yang Anda hadapi minggu ini..."></textarea>
                            </div>

                            <div class="flex gap-3 mt-4 no-print">
                                <button class="btn btn-primary" onclick="saveWeeklyEval()">
                                    <i class="fas fa-save"></i>
                                    Simpan Evaluasi
                                </button>
                                <button class="btn btn-outline" onclick="printWeeklyEval()">
                                    <i class="fas fa-print"></i>
                                    Cetak PDF
                                </button>
                            </div>

                            <div class="mt-4 p-4 bg-green-50 rounded-lg border border-green-200 text-center no-print">
                                <p class="text-sm text-green-800 mb-2">Butuh bantuan atau konsultasi?</p>
                                <a href="https://wa.me/6281546450547" target="_blank" class="inline-flex items-center gap-2 bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700 transition">
                                    <i class="fab fa-whatsapp"></i>
                                    Hubungi Konsultan
                                </a>
                            </div>
                        </div>

                        <!-- History -->
                        <div id="weeklyHistory" class="mt-6 space-y-3">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <!-- Tips -->
                    <div class="mt-6">
                        <h4 class="font-semibold mb-4 text-sm uppercase tracking-wide text-gray-600">Tips Sukses Diet</h4>
                        <div class="tips-grid">
                            <div class="tip-card">
                                <div class="tip-icon text-blue-500"><i class="fas fa-tint"></i></div>
                                <div class="tip-title">Hidrasi</div>
                                <div class="tip-desc">Minum 8 gelas air putih sepanjang hari</div>
                            </div>
                            <div class="tip-card">
                                <div class="tip-icon text-green-500"><i class="fas fa-bed"></i></div>
                                <div class="tip-title">Tidur</div>
                                <div class="tip-desc">Istirahat 7-8 jam untuk metabolisme optimal</div>
                            </div>
                            <div class="tip-card">
                                <div class="tip-icon text-yellow-500"><i class="fas fa-walking"></i></div>
                                <div class="tip-title">Aktivitas</div>
                                <div class="tip-desc">Minimal 30 menit aktivitas fisik</div>
                            </div>
                            <div class="tip-card">
                                <div class="tip-icon text-red-500"><i class="fas fa-ban"></i></div>
                                <div class="tip-title">Hindari</div>
                                <div class="tip-desc">Gula, gorengan, & minuman bersoda</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Consultation Info (Replaced CTA) -->
            <div class="consultation-card animate-fade-in delay-300 no-print">
                <div class="consultation-badge">Gratis Konsultasi</div>
                <h3 class="consultation-title font-display">Butuh Pendampingan?</h3>
                <p class="consultation-desc">Dapatkan konsultasi gratis dengan ahli gizi kami untuk memaksimalkan hasil program diet herbal Anda.</p>
                <div class="flex flex-col gap-3">
                    <a href="https://wa.me/6281546450547" target="_blank" class="btn btn-gold">
                        <i class="fab fa-whatsapp"></i>
                        Hubungi Konsultan Sekarang
                    </a>
                    <p class="text-xs opacity-80">Klik tombol di atas untuk terhubung via WhatsApp</p>
                </div>
            </div>

            <!-- Footer -->
            <footer class="text-center text-gray-400 text-xs mt-8 pb-8">
                <p class="mb-2">CALFATLOSS - Smart Nutrition System</p>
                <p>Hasil estimasi, konsultasikan dengan ahli gizi untuk kondisi khusus</p>
            </footer>

        </div>
    </div>

    <script>
        // Global Variables
        let currentCode = '';
        let userData = {
            nama: '',
            gender: '',
            usia: 0,
            berat: 0,
            tinggi: 0,
            aktivitas: 0,
            target: 0,
            metode: 'standar',
            bmr: 0,
            tdee: 0,
            dietCal: 0,
            weeks: 0,
            targetDate: '',
            protein: 0,
            lemak: 0,
            karbo: 0
        };

        let weeklyConditions = {
            energi: false,
            nafsu: false,
            efek: false,
            tidur: false
        };

        let weeklyHistory = [];

        // Constants
        const deficitMap = {
            'ringan': 300,
            'standar': 500,
            'agresif': 700
        };

        const activityDescriptions = {
            '1.2': 'Hampir tidak berolahraga, pekerjaan kantoran',
            '1.375': 'Olahraga ringan 1-2x per minggu',
            '1.55': 'Olahraga sedang 3-5x per minggu',
            '1.725': 'Olahraga berat 6-7x per minggu',
            '1.9': 'Pekerja fisik atau atlet profesional'
        };

        // ACCESS CONTROL - Check code on load
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const codeFromUrl = urlParams.get('kode'); // Changed from 'code' to 'kode' to match login page
            
            if (!codeFromUrl) {
                // No code in URL - show access denied
                showAccessDenied();
                return;
            }
            
            // Code exists in URL - validate and initialize
            currentCode = codeFromUrl.toUpperCase();
            
            // Save to localStorage for persistence
            localStorage.setItem('calfatloss_code', currentCode);
            
            // Create session
            createSession(currentCode);
            
            // Initialize app
            initializeApp();
        });

        function showAccessDenied() {
            document.getElementById('accessCheck').style.display = 'none';
            document.getElementById('accessDenied').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }

        function goToLogin() {
            // Redirect to login/verification page
            window.location.href = 'index.html'; // atau nama file halaman log aktivitas Anda
        }

        function createSession(code) {
            // Simulate session creation
            const session = {
                code: code,
                createdAt: new Date().toISOString(),
                expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() // 24 hours
            };
            localStorage.setItem(`calfatloss_session_${code}`, JSON.stringify(session));
        }

        function initializeApp() {
            document.getElementById('accessCheck').style.display = 'none';
            document.getElementById('accessDenied').style.display = 'none';
            document.getElementById('mainApp').classList.remove('section-hidden');
            document.getElementById('mainApp').classList.add('section-visible');
            document.getElementById('userCodeDisplay').textContent = `Kode: ${currentCode}`;
            
            // Setup activity description listener
            document.getElementById('inputAktivitas')?.addEventListener('change', function() {
                const desc = activityDescriptions[this.value] || 'Pilih level aktivitas untuk melihat keterangan';
                document.getElementById('activityDesc').textContent = desc;
            });
            
            // Load user data for this specific code
            loadUserData();
        }

        function loadUserData() {
            const saved = localStorage.getItem(`calfatloss_data_${currentCode}`);
            const savedWeekly = localStorage.getItem(`calfatloss_weekly_${currentCode}`);
            
            if (saved) {
                const data = JSON.parse(saved);
                userData = data;
                
                // Fill inputs
                if (data.nama) document.getElementById('inputNama').value = data.nama;
                if (data.gender) document.getElementById('inputGender').value = data.gender;
                if (data.usia) document.getElementById('inputUsia').value = data.usia;
                if (data.berat) document.getElementById('inputBerat').value = data.berat;
                if (data.tinggi) document.getElementById('inputTinggi').value = data.tinggi;
                if (data.aktivitas) {
                    document.getElementById('inputAktivitas').value = data.aktivitas;
                    document.getElementById('activityDesc').textContent = activityDescriptions[data.aktivitas] || '';
                }
                if (data.target) document.getElementById('inputTarget').value = data.target;
                if (data.metode) document.getElementById('inputMetode').value = data.metode;
                
                // If data complete, show program without scrolling
                if (data.nama && data.gender) {
                    calculateAndShowProgram(false);
                }
            }
            
            // Load weekly history
            if (savedWeekly) {
                weeklyHistory = JSON.parse(savedWeekly);
                renderWeeklyHistory();
            }
        }

        function saveUserData() {
            localStorage.setItem(`calfatloss_data_${currentCode}`, JSON.stringify(userData));
        }

        function saveWeeklyData() {
            localStorage.setItem(`calfatloss_weekly_${currentCode}`, JSON.stringify(weeklyHistory));
        }

        function calculateBMR(gender, weight, height, age) {
            if (gender === 'pria') {
                return (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                return (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }
        }

        function calculateAndShowProgram(shouldScroll = true) {
            userData.nama = document.getElementById('inputNama').value;
            userData.gender = document.getElementById('inputGender').value;
            userData.usia = parseFloat(document.getElementById('inputUsia').value);
            userData.berat = parseFloat(document.getElementById('inputBerat').value);
            userData.tinggi = parseFloat(document.getElementById('inputTinggi').value);
            userData.aktivitas = parseFloat(document.getElementById('inputAktivitas').value);
            userData.target = parseFloat(document.getElementById('inputTarget').value);
            userData.metode = document.getElementById('inputMetode').value;

            if (!userData.nama || !userData.gender || !userData.usia || !userData.berat || !userData.tinggi || !userData.aktivitas || !userData.target) {
                alert('Mohon lengkapi semua data terlebih dahulu');
                return;
            }

            if (userData.target >= userData.berat) {
                alert('Target berat harus lebih rendah dari berat saat ini');
                return;
            }

            // Calculations
            userData.bmr = calculateBMR(userData.gender, userData.berat, userData.tinggi, userData.usia);
            userData.tdee = userData.bmr * userData.aktivitas;
            
            const deficit = deficitMap[userData.metode];
            userData.dietCal = Math.max(1200, userData.tdee - deficit);
            
            const weeklyLoss = (deficit * 7) / 7700;
            userData.weeks = Math.ceil((userData.berat - userData.target) / weeklyLoss);

            // Calculate target date
            const today = new Date();
            const targetDate = new Date(today);
            targetDate.setDate(today.getDate() + (userData.weeks * 7));
            userData.targetDate = targetDate.toLocaleDateString('id-ID', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            // Macros
            const proteinMult = userData.metode === 'agresif' ? 2.2 : (userData.metode === 'ringan' ? 1.8 : 2.0);
            userData.protein = userData.berat * proteinMult;
            userData.lemak = userData.berat * 0.8;
            userData.karbo = (userData.dietCal - (userData.protein * 4) - (userData.lemak * 9)) / 4;

            saveUserData();
            updateCalculatorUI();
            generateTimeline();
            generateMealPlan();
            
            document.getElementById('programSection').classList.remove('section-hidden');
            document.getElementById('programSection').classList.add('section-visible');
            
            if (shouldScroll) {
                setTimeout(() => {
                    document.getElementById('programSection').scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }

        function updateCalculatorUI() {
            document.getElementById('quickResults').style.display = 'grid';
            document.getElementById('previewCalories').textContent = Math.round(userData.dietCal);
            document.getElementById('previewWeeks').textContent = userData.weeks;
            
            document.getElementById('heroWeeks').textContent = userData.weeks;
            document.getElementById('heroLoss').textContent = userData.metode === 'agresif' ? '0.7-1' : (userData.metode === 'ringan' ? '0.3-0.5' : '0.5-0.7');

            // Show date estimate
            document.getElementById('dateEstimate').style.display = 'block';
            document.getElementById('targetDateDisplay').textContent = userData.targetDate;
        }

        function generateTimeline() {
            const timeline = document.getElementById('dietTimeline');
            timeline.innerHTML = '';

            const phases = [
                { week: 1, title: 'Fase Detox (Minggu 1)', desc: 'Adaptasi metabolisme. Mulai konsumsi 2x3 kapsul herbal sesudah makan (pagi & malam). Fokus pengurangan gula.' },
                { week: 2, title: 'Fase Aktivasi (Minggu 2)', desc: 'Metabolisme meningkat. Berat turun 0.5-1kg. Konsisten minum 6 kapsul/hari. Aktivitas: jalan kaki + latihan lymphatic.' },
                { week: 3, title: 'Fase Pembakaran (Minggu 3-4)', desc: 'Lemak terbakar efektif. Sinergi diet + herbal optimal. Rutin latihan lymphatic untuk drainase optimal.' },
                { week: 6, title: 'Evaluasi Tengah (Minggu 6)', desc: 'Cek progress. Gunakan lembar evaluasi mingguan. Jika stagnan, konsultasi gratis tersedia.' },
                { week: userData.weeks, title: 'Target Tercapai!', desc: `Selamat ${userData.nama}! Capai target ${userData.target}kg pada ${userData.targetDate}. Lanjutkan ke FASE MAINTENANCE: Turun dosis herbal jadi 2x2 kapsul/hari.` }
            ];

            phases.forEach((phase, index) => {
                const isLast = index === phases.length - 1;
                const dotClass = isLast ? 'active' : '';
                
                const html = `
                    <div class="timeline-item">
                        <div class="timeline-dot ${dotClass}">${isLast ? '<i class="fas fa-flag"></i>' : phase.week}</div>
                        <div class="timeline-content">
                            <h4>${phase.title}</h4>
                            <p>${phase.desc}</p>
                        </div>
                    </div>
                `;
                timeline.innerHTML += html;
            });

            setTimeout(() => {
                const circle = document.getElementById('progressCircle');
                const radius = circle.r.baseVal.value;
                const circumference = radius * 2 * Math.PI;
                const offset = circumference - (10/100) * circumference;
                circle.style.strokeDashoffset = offset;
                document.getElementById('progressPercent').textContent = '10%';
            }, 500);
        }

        function generateMealPlan() {
            const container = document.getElementById('mealContainer');
            document.getElementById('mealTargetCal').textContent = Math.round(userData.dietCal) + ' kcal';
            
            const meals = [
                { time: '07:00', title: 'Sarapan (25%)', cal: Math.round(userData.dietCal * 0.25), 
                  menu: `2 Telur rebus + 1 Pisang + 3 kapsul herbal sesudah makan` },
                { time: '10:00', title: 'Snack Pagi (10%)', cal: Math.round(userData.dietCal * 0.10), 
                  menu: `Buah segar (apel/jeruk) + kacang almond 10 butir` },
                { time: '12:00', title: 'Makan Siang (30%)', cal: Math.round(userData.dietCal * 0.30), 
                  menu: `Nasi merah 100g + dada ayam 150g + sayur tumis` },
                { time: '15:00', title: 'Snack Sore (10%)', cal: Math.round(userData.dietCal * 0.10), 
                  menu: `Yogurt plain + granola atau smoothie green` },
                { time: '18:00', title: 'Makan Malam (25%)', cal: Math.round(userData.dietCal * 0.25), 
                  menu: `Ikan kukus 150g + salad sayur + kentang rebus + 3 kapsul herbal sesudah makan` }
            ];

            container.innerHTML = meals.map(meal => `
                <div class="meal-card">
                    <div class="meal-time-box">
                        <div class="meal-time-label">JAM</div>
                        <div class="meal-time-value">${meal.time}</div>
                    </div>
                    <div class="meal-content">
                        <div class="meal-title">${meal.title}</div>
                        <div class="meal-desc">${meal.menu}</div>
                    </div>
                    <div class="meal-cal">~${meal.cal}<br><small>kcal</small></div>
                </div>
            `).join('');
        }

        function showMealPlan() {
            document.getElementById('mealSection').classList.remove('section-hidden');
            document.getElementById('mealSection').classList.add('section-visible');
            
            // Set current week
            const currentWeek = weeklyHistory.length + 1;
            document.getElementById('evalWeekDisplay').textContent = `Minggu ke-${currentWeek}`;
            
            setTimeout(() => {
                document.getElementById('mealSection').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // Weekly Evaluation Functions
        function toggleCondition(element, type) {
            element.classList.toggle('checked');
            weeklyConditions[type] = element.classList.contains('checked');
        }

        function calculateWeeklyLoss() {
            const start = parseFloat(document.getElementById('weekStartWeight').value) || 0;
            const end = parseFloat(document.getElementById('weekEndWeight').value) || 0;
            
            if (start > 0 && end > 0) {
                const loss = (start - end).toFixed(1);
                document.getElementById('weeklyResult').style.display = 'block';
                document.getElementById('weightLossValue').textContent = `${loss} kg`;
            }
        }

        function saveWeeklyEval() {
            const startWeight = parseFloat(document.getElementById('weekStartWeight').value);
            const endWeight = parseFloat(document.getElementById('weekEndWeight').value);
            const obstacle = document.getElementById('weeklyObstacle').value;
            
            if (!startWeight || !endWeight) {
                alert('Mohon isi berat awal dan akhir minggu');
                return;
            }

            const weekData = {
                week: weeklyHistory.length + 1,
                date: new Date().toLocaleDateString('id-ID'),
                startWeight: startWeight,
                endWeight: endWeight,
                loss: (startWeight - endWeight).toFixed(1),
                conditions: {...weeklyConditions},
                obstacle: obstacle
            };

            weeklyHistory.push(weekData);
            saveWeeklyData();
            renderWeeklyHistory();
            
            // Reset form
            document.getElementById('weekStartWeight').value = '';
            document.getElementById('weekEndWeight').value = '';
            document.getElementById('weeklyObstacle').value = '';
            document.querySelectorAll('.condition-item').forEach(el => el.classList.remove('checked'));
            weeklyConditions = { energi: false, nafsu: false, efek: false, tidur: false };
            document.getElementById('weeklyResult').style.display = 'none';
            
            // Update week display
            document.getElementById('evalWeekDisplay').textContent = `Minggu ke-${weeklyHistory.length + 1}`;
            
            alert('Evaluasi mingguan berhasil disimpan!');
        }

        function renderWeeklyHistory() {
            const container = document.getElementById('weeklyHistory');
            if (weeklyHistory.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 text-sm">Belum ada data evaluasi mingguan</p>';
                return;
            }

            container.innerHTML = weeklyHistory.map((week, index) => `
                <div class="bg-white p-4 rounded-lg border border-gray-200">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold text-sm">Minggu ${week.week}</span>
                        <span class="text-xs text-gray-500">${week.date}</span>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center mb-2">
                        <div>
                            <div class="text-xs text-gray-500">Awal</div>
                            <div class="font-semibold">${week.startWeight} kg</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-500">Akhir</div>
                            <div class="font-semibold">${week.endWeight} kg</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-500">Turun</div>
                            <div class="font-semibold text-green-600">${week.loss} kg</div>
                        </div>
                    </div>
                    ${week.obstacle ? `<div class="text-xs text-gray-600 mt-2"><strong>Kendala:</strong> ${week.obstacle}</div>` : ''}
                </div>
            `).join('');
        }

        function printWeeklyEval() {
            window.print();
        }

        // Auto-save inputs on change
        ['inputNama', 'inputGender', 'inputUsia', 'inputBerat', 'inputTinggi', 'inputAktivitas', 'inputTarget', 'inputMetode'].forEach(id => {
            document.getElementById(id)?.addEventListener('change', () => {
                if (currentCode) {
                    userData.nama = document.getElementById('inputNama').value;
                    userData.gender = document.getElementById('inputGender').value;
                    userData.usia = parseFloat(document.getElementById('inputUsia').value) || 0;
                    userData.berat = parseFloat(document.getElementById('inputBerat').value) || 0;
                    userData.tinggi = parseFloat(document.getElementById('inputTinggi').value) || 0;
                    userData.aktivitas = parseFloat(document.getElementById('inputAktivitas').value) || 0;
                    userData.target = parseFloat(document.getElementById('inputTarget').value) || 0;
                    userData.metode = document.getElementById('inputMetode').value;
                    saveUserData();
                }
            });
        });
    </script>
</body>
</html>
