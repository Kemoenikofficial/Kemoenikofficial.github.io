<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dashboard Voucher</title>
  <style>
    body { font-family: Arial; background:#f4f4f4; padding:20px; }
    .card { background:white; padding:20px; margin-bottom:20px; border-radius:8px; }
    .btn { padding:10px 20px; border:none; border-radius:6px; cursor:pointer; }
    .green { background:green; color:white; }
    .red { background:red; color:white; }
  </style>
</head>
<body>

<h2>DASHBOARD VOUCHER</h2>

<div class="card">
  <p>Total: <b id="total">0</b></p>
  <p>Used: <b id="used">0</b></p>
  <p>Available: <b id="unused">0</b></p>
  <p>Expired: <b id="expired">0</b></p>
</div>

<div class="card">
  <button id="generateBtn" class="btn green" onclick="generateVoucher()">
    Generate 100 Voucher
  </button>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbx7vsSRKu2P77j6LOTghbnes4lUcbCr6q0ELEJsnO933PQbqv_Z-JEQfKiZzVrGTNKe/exec";

// ================= LOAD DASHBOARD =================
async function loadDashboard() {
  try {
    const res = await fetch(`${WEB_APP_URL}?action=getDashboardData`, {
      method: "GET"
    });

    const data = await res.json();

    document.getElementById("total").innerText = data.total;
    document.getElementById("used").innerText = data.used;
    document.getElementById("unused").innerText = data.unused;
    document.getElementById("expired").innerText = data.expired;

    updateButtonColor(data.unused);

  } catch (err) {
    console.error(err);
    alert("Gagal ambil data dashboard");
  }
}

// ================= GENERATE =================
async function generateVoucher() {
  try {
    const res = await fetch(
      `${WEB_APP_URL}?action=generate&adminUser=DANIRAMDANI&adminPass=KEMOENIK26`,
      { method: "GET" }
    );

    const result = await res.json();

    if (result.success) {
      alert("+100 voucher berhasil ditambahkan");
      loadDashboard();
    } else {
      alert("Generate gagal");
    }

  } catch (err) {
    console.error(err);
    alert("Generate gagal");
  }
}

// ================= BUTTON COLOR =================
function updateButtonColor(unused) {
  const btn = document.getElementById("generateBtn");

  if (unused <= 5) {
    btn.classList.remove("green");
    btn.classList.add("red");
  } else {
    btn.classList.remove("red");
    btn.classList.add("green");
  }
}

// ================= AUTO LOAD =================
document.addEventListener("DOMContentLoaded", function () {
  loadDashboard();
  setInterval(loadDashboard, 10000); // refresh tiap 10 detik
});
</script>

</body>
</html>
